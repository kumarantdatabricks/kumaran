{{
    config(
        materialized="incremental",
        unique_key=[
            "envelope.event_uuid",
            "envelope.event_client_start_dtm",
        ],
        incremental_strategy="merge",
        partition_by="client_data_pst_dt,platform_nm",
        pre_hook=["SET STATEMENT_TIMEOUT = 86400"],
        post_hook=["REFRESH table {{this}}"],
    )
}}

-- clickstream_event_registry_exclusions includes list of event_ids to be excluded
-- from clickstream_mobile_web.
-- These event_ids have the highest volume of data in clickstream that is not relevant
-- to zhl
-- Excluding data from these event_ids will discard 85% of clickstream data volume
-- that is not necessary for our use-case
with
    clickstream_event_registry_exclusions as (
        select event_type_id, zodiac_team
        from
            (
                values
                    ('33', 'adtech-product'),
                    ('43', 'discover-experience'),
                    ('46', 'searchxp'),
                    ('47', 'detail-page-framework'),
                    ('48', 'detail-page-framework'),
                    ('65', 'searchxp'),
                    ('74', 'searchxp'),
                    ('76', 'searchxp'),
                    ('93', 'apps-evaluate'),
                    ('143', 'ios-shopping'),
                    ('161', 'ios-shopping'),
                    ('167', 'ios-shopping'),
                    ('617', 'android-shopping'),
                    ('715', 'ios-shopping'),
                    ('721', 'ios-shopping'),
                    ('727', 'ios-shopping'),
                    ('737', 'android-shopping'),
                    ('746', 'apps-evaluate'),
                    ('1000', 'android-shopping'),
                    ('1001', 'ios-shopping'),
                    ('1024', 'android-shopping'),
                    ('1025', 'ios-shopping'),
                    ('1027', 'ios-shopping'),
                    ('1028', 'searchxp'),
                    ('1035', 'searchxp'),
                    ('1036', 'searchxp'),
                    ('1039', 'discover-experience'),
                    ('1041', 'ios-shopping'),
                    ('1053', 'apps-evaluate'),
                    ('1059', 'android-shopping'),
                    ('1067', 'ios-shopping'),
                    ('1083', 'searchxp'),
                    ('2034', 'adtech-product'),
                    ('2467', 'rmx-consumer'),
                    ('2497', 'rmx-consumer'),
                    ('2540', 'detail-page-framework'),
                    ('2542', 'detail-page-framework'),
                    ('2600', 'ios-shopping'),
                    ('2614', 'ios-engagement'),
                    ('2724', 'ios-shopping'),
                    ('2802', 'discover-experience'),
                    ('2803', 'ios-shopping'),
                    ('2804', 'android-shopping'),
                    ('2830', 'apps-evaluate'),
                    ('2832', 'apps-evaluate'),
                    ('2833', 'apps-evaluate'),
                    ('2841', 'social-impact'),
                    ('2871', 'detail-page-framework'),
                    ('2920', 'discover-experience'),
                    ('2944', 'authentication'),
                    ('3034', 'new-construction'),
                    ('3576', 'rentals-mobile-android'),
                    ('3672', 'ios-shopping'),
                    ('3733', 'ios-shopping'),
                    ('3736', 'discover-experience'),
                    ('3765', 'traffic'),
                    ('3828', 'adtech-product'),
                    ('3882', 'ios-shopping'),
                    ('3951', 'for-sale-hdp'),
                    ('3952', 'for-sale-hdp'),
                    ('3955', 'for-sale-hdp'),
                    ('3956', 'for-sale-hdp'),
                    ('3964', 'for-sale-hdp'),
                    ('3966', 'for-sale-hdp'),
                    ('4022', 'for-sale-hdp'),
                    ('4025', 'ios-engagement'),
                    ('4180', 'apps-evaluate'),
                    ('4255', 'apps-evaluate'),
                    ('4256', 'apps-evaluate'),
                    ('4258', 'apps-evaluate'),
                    ('4283', 'growth-activation'),
                    ('4376', 'discover-experience'),
                    ('4457', 'vertical-living'),
                    ('4458', 'vertical-living'),
                    ('4459', 'vertical-living'),
                    ('4613', 'searchxp'),
                    ('4616', 'searchxp'),
                    ('4685', ''),
                    ('4689', ''),
                    ('4762', ''),
                    ('4784', ''),
                    ('4808', ''),
                    ('5451', '')

            ) as t(event_type_id, zodiac_team)
    ),

    daily_mobile_nopii as (
        select
            client_ts,
            client_data_pst_dt,
            cast(
                struct(
                    envelope.event_type_id,
                    envelope.event_uuid,
                    envelope.event_client_start_dtm
                ) as struct<
                    event_type_id string,
                    event_uuid string,
                    event_client_start_dtm string
                >
            ) as envelope,
            cast(
                struct(semantic.semantic_event_nm, semantic.topic_tag_txt) as struct<
                    semantic_event_nm string, topic_tag_txt array<string>
                >
            ) as semantic,
            cast(
                struct(
                    clickstream_trigger.trigger_location_nm,
                    clickstream_trigger.trigger_type_nm,
                    clickstream_trigger.trigger_object_nm,
                    clickstream_trigger.trigger_source_nm,
                    clickstream_trigger.screen_display_title_nm,
                    clickstream_trigger.trigger_reference_url,
                    clickstream_trigger.trigger_subdomain_nm,
                    clickstream_trigger.trigger_path_nm,
                    clickstream_trigger.input_selector_nm,
                    clickstream_trigger.referral_url,
                    clickstream_trigger.itc_parameters,
                    clickstream_trigger.itc_parameters_txt
                ) as struct<
                    trigger_location_nm string,
                    trigger_type_nm string,
                    trigger_object_nm string,
                    trigger_source_nm string,
                    screen_display_title_nm string,
                    trigger_reference_url string,
                    trigger_subdomain_nm string,
                    trigger_path_nm string,
                    input_selector_nm string,
                    referral_url string,
                    itc_parameters string,
                    itc_parameters_txt string
                >
            ) as clickstream_trigger,
            cast(
                struct(
                    user_info.pii_join_key,
                    user_info.zuid,
                    user_info.guid,
                    user_info.first_visit_dt,
                    user_info.bot_ind,
                    user_info.internal_zillow_group_user_ind,
                    user_info.webview_guid
                ) as struct<
                    pii_join_key string,
                    zuid string,
                    guid string,
                    first_visit_dt string,
                    bot_ind boolean,
                    internal_zillow_group_user_ind boolean,
                    webview_guid string
                >
            ) as user_info,
            cast(
                struct(
                    event_enrichment.event_nb, event_enrichment.screen_view_nb
                ) as struct<event_nb integer, screen_view_nb integer>
            ) as event_enrichment,
            cast(
                struct(
                    content_page.displayed_button_txt,
                    content_page.displayed_field_txt
                ) as struct<
                    displayed_button_txt array<string>,
                    displayed_field_txt array<string>
                >
            ) as content_page,
            cast(
                struct(
                    app_info.app_type_nm,
                    app_info.app_nm,
                    app_info.app_version_id,
                    app_info.app_ns,
                    app_info.app_bld,
                    app_info.sdk_nm,
                    app_info.sdk_version_id,
                    app_info.environment_nm
                ) as struct<
                    app_type_nm string,
                    app_nm string,
                    app_version_id string,
                    app_ns string,
                    app_bld string,
                    sdk_nm string,
                    sdk_version_id string,
                    environment_nm string
                >
            ) as app_info,
            cast(
                struct(
                    cross_domain_tracking.zillow_guid,
                    cross_domain_tracking.zillow_saved_ts,
                    cross_domain_tracking.zillow_uid,
                    cross_domain_tracking.zhl_guid,
                    cross_domain_tracking.zhl_uid,
                    cross_domain_tracking.zhl_saved_ts
                ) as struct<
                    zillow_guid string,
                    zillow_saved_ts string,
                    zillow_uid string,
                    zhl_guid string,
                    zhl_uid string,
                    zhl_saved_ts string
                >
            ) as cross_domain_tracking,
            cast(
                struct(
                    user_session_enrichment.session_id,
                    user_session_enrichment.original_session_id,
                    user_session_enrichment.event_client_start_pst_dtm,
                    user_session_enrichment.session_start_pst_dtm,
                    user_session_enrichment.session_end_pst_dtm
                ) as struct<
                    session_id string,
                    original_session_id string,
                    event_client_start_pst_dtm string,
                    session_start_pst_dtm string,
                    session_end_pst_dtm string
                >
            ) as user_session_enrichment,
            cast(
                struct(
                    exposure.randomization_key,
                    exposure.key_type_cd,
                    exposure.decision_token_id,
                    exposure.treatment_nm,
                    exposure.assignment_service_cd,
                    exposure.extended_info_txt
                ) as struct<
                    randomization_key string,
                    key_type_cd string,
                    decision_token_id string,
                    treatment_nm array<string>,
                    assignment_service_cd string,
                    extended_info_txt string
                >
            ) as exposure,
            cast(
                struct(
                    marketing_info.referral_url,
                    marketing_info.utm_source_nm,
                    marketing_info.utm_medium_nm,
                    marketing_info.utm_campaign_nm,
                    marketing_info.utm_term_nm,
                    marketing_info.utm_content_nm,
                    marketing_info.channel_grouping,
                    marketing_info.campaign_id,
                    marketing_info.campaign_cd
                ) as struct<
                    referral_url string,
                    utm_source_nm string,
                    utm_medium_nm string,
                    utm_campaign_nm string,
                    utm_term_nm string,
                    utm_content_nm string,
                    channel_grouping string,
                    campaign_id string,
                    campaign_cd string
                >
            ) as marketing_info,
            cast(
                struct(
                    session_marketing_info.referral_url,
                    session_marketing_info.utm_source_nm,
                    session_marketing_info.utm_medium_nm,
                    session_marketing_info.utm_campaign_nm,
                    session_marketing_info.utm_term_nm,
                    session_marketing_info.utm_content_nm,
                    session_marketing_info.channel_grouping,
                    session_marketing_info.campaign_id,
                    session_marketing_info.campaign_cd
                ) as struct<
                    referral_url string,
                    utm_source_nm string,
                    utm_medium_nm string,
                    utm_campaign_nm string,
                    utm_term_nm string,
                    utm_content_nm string,
                    channel_grouping string,
                    campaign_id string,
                    campaign_cd string
                >
            ) as session_marketing_info,
            cast(
                struct(
                    top_navigation.target_url,
                    top_navigation.level_one_txt,
                    top_navigation.level_two_txt,
                    top_navigation.level_three_txt
                ) as struct<
                    target_url string,
                    level_one_txt string,
                    level_two_txt string,
                    level_three_txt string
                >
            ) as top_navigation,
            cast(
                struct(
                    abad_info.abad_context_txt,
                    abad_info.abad_version_nb,
                    abad_info.abad_close_button_txt
                ) as struct<
                    abad_context_txt string,
                    abad_version_nb integer,
                    abad_close_button_txt string
                >
            ) as abad_info,
            cast(
                struct(
                    contact_request_form.title_txt,
                    contact_request_form.form_id,
                    contact_request_form.variant_txt,
                    contact_request_form.version_nb,
                    contact_request_form.displayed_button_txt,
                    contact_request_form.displayed_field_txt,
                    contact_request_form.finance_ind,
                    contact_request_form.agent_transfer_ind,
                    contact_request_form.pa_lead_id,
                    contact_request_form.tour_type_txt,
                    contact_request_form.my_agent_relationship_id,
                    contact_request_form.appointment_hash_txt,
                    contact_request_form.tour_status_txt,
                    contact_request_form.tour_notes_ind,
                    contact_request_form.tour_feedback_question_txt
                ) as struct<
                    title_txt string,
                    form_id string,
                    variant_txt string,
                    version_nb string,
                    displayed_button_txt string,
                    displayed_field_txt string,
                    finance_ind boolean,
                    agent_transfer_ind boolean,
                    pa_lead_id string,
                    tour_type_txt string,
                    my_agent_relationship_id string,
                    appointment_hash_txt string,
                    tour_status_txt string,
                    tour_notes_ind boolean,
                    tour_feedback_question_txt string
                >
            ) as contact_request_form,
            cast(
                struct(
                    financing_cta.language_on_cta_txt,
                    financing_cta.cta_destination_txt,
                    financing_cta.est_payment_amt,
                    financing_cta.rate_source_txt,
                    financing_cta.disclaimer_txt,
                    financing_cta.experiment_trial_txt,
                    financing_cta.experiment_treatment_txt
                ) as struct<
                    language_on_cta_txt string,
                    cta_destination_txt string,
                    est_payment_amt double,
                    rate_source_txt string,
                    disclaimer_txt string,
                    experiment_trial_txt string,
                    experiment_treatment_txt string
                >
            ) as financing_cta,
            cast(
                struct(
                    form_interaction_info.interaction_type_txt,
                    form_interaction_info.question_txt,
                    form_interaction_info.field_name_txt
                ) as struct<
                    interaction_type_txt string,
                    question_txt string,
                    field_name_txt string
                >
            ) as form_interaction_info,
            cast(
                struct(miso_dashboard.miso_id, miso_dashboard.zpid) as struct<
                    miso_id string, zpid integer
                >
            ) as miso_dashboard,
            cast(
                struct(miso_questionnaire.miso_id, miso_questionnaire.zpid) as struct<
                    miso_id string, zpid integer
                >
            ) as miso_questionnaire,
            cast(
                struct(
                    omp.event_type_nm,
                    omp.skip_display_reason_txt,
                    omp.should_display_ind,
                    omp.global_holdout_ind,
                    omp.placement_holdout_ind,
                    omp.placement_nm,
                    omp.test_phase_nm,
                    omp.bucket_nm,
                    omp.placement_id,
                    omp.throttle_pass_ind,
                    omp.last_modified_dtm,
                    omp.event_id,
                    omp.decision_context_guid,
                    omp.decision_context_encoded_zuid,
                    omp.selected_treatment_id,
                    omp.selected_treatment_nm,
                    omp.selected_treatment_status_cd,
                    omp.selected_treatment_last_modified_dtm,
                    omp.selected_treatment_lob_nm,
                    omp.selected_treatment_experiment_family_nm,
                    omp.selected_treatment_experiment_iteration_txt,
                    omp.selected_treatment_variation_nm,
                    omp.qualified_treatment_portfolio_nm,
                    omp.qualified_treatment_portfolio_test_nm,
                    omp.qualified_treatment_target_selection_nm,
                    omp.qualified_treatment_baseline_evaluation_nm
                ) as struct<
                    event_type_nm string,
                    skip_display_reason_txt string,
                    should_display_ind boolean,
                    global_holdout_ind boolean,
                    placement_holdout_ind boolean,
                    placement_nm string,
                    test_phase_nm string,
                    bucket_nm string,
                    placement_id integer,
                    throttle_pass_ind boolean,
                    last_modified_dtm string,
                    event_id string,
                    decision_context_guid string,
                    decision_context_encoded_zuid string,
                    selected_treatment_id integer,
                    selected_treatment_nm string,
                    selected_treatment_status_cd string,
                    selected_treatment_last_modified_dtm string,
                    selected_treatment_lob_nm string,
                    selected_treatment_experiment_family_nm string,
                    selected_treatment_experiment_iteration_txt string,
                    selected_treatment_variation_nm string,
                    qualified_treatment_portfolio_nm array<string>,
                    qualified_treatment_portfolio_test_nm array<string>,
                    qualified_treatment_target_selection_nm array<string>,
                    qualified_treatment_baseline_evaluation_nm array<string>
                >
            ) as omp,
            cast(
                struct(
                    premier_agent_contact.contact_id,
                    premier_agent_contact.current_contact_status_txt,
                    premier_agent_contact.target_contact_status_txt,
                    premier_agent_contact.transaction_id
                ) as struct<
                    contact_id integer,
                    current_contact_status_txt string,
                    target_contact_status_txt string,
                    transaction_id string
                >
            ) as premier_agent_contact,
            cast(
                struct(
                    zgmi_connect_funnel.connect_version_txt,
                    zgmi_connect_funnel.city_or_zip_txt,
                    zgmi_connect_funnel.zip_code_txt,
                    zgmi_connect_funnel.state_txt,
                    zgmi_connect_funnel.city_txt,
                    zgmi_connect_funnel.county_txt,
                    zgmi_connect_funnel.county_fips_txt,
                    zgmi_connect_funnel.loan_type_txt,
                    zgmi_connect_funnel.first_time_ind,
                    zgmi_connect_funnel.home_owner_ind,
                    zgmi_connect_funnel.selling_ind,
                    zgmi_connect_funnel.journey_stage_txt,
                    zgmi_connect_funnel.needs_txt,
                    zgmi_connect_funnel.property_type_txt,
                    zgmi_connect_funnel.property_usage_txt,
                    zgmi_connect_funnel.va_eligible_ind,
                    zgmi_connect_funnel.property_value_amt,
                    zgmi_connect_funnel.down_payment_amt,
                    zgmi_connect_funnel.down_payment_pct,
                    zgmi_connect_funnel.income_amt,
                    zgmi_connect_funnel.self_reported_credit_txt,
                    zgmi_connect_funnel.self_employed_ind,
                    zgmi_connect_funnel.credit_history_ind,
                    zgmi_connect_funnel.has_agent_ind,
                    zgmi_connect_funnel.need_agent_ind,
                    zgmi_connect_funnel.language_txt,
                    zgmi_connect_funnel.loan_balance_amt,
                    zgmi_connect_funnel.second_mortgage_ind,
                    zgmi_connect_funnel.cash_out_ind,
                    zgmi_connect_funnel.heloc_amt,
                    zgmi_connect_funnel.vermont_agreed_ind,
                    zgmi_connect_funnel.zgmi_contact_id,
                    zgmi_connect_funnel.zgmi_missed_opportunity_id,
                    zgmi_connect_funnel.zhl_lead_id,
                    zgmi_connect_funnel.lender_matches_nb
                ) as struct<
                    connect_version_txt string,
                    city_or_zip_txt string,
                    zip_code_txt string,
                    state_txt string,
                    city_txt string,
                    county_txt string,
                    county_fips_txt string,
                    loan_type_txt string,
                    first_time_ind boolean,
                    home_owner_ind boolean,
                    selling_ind boolean,
                    journey_stage_txt string,
                    needs_txt string,
                    property_type_txt string,
                    property_usage_txt string,
                    va_eligible_ind boolean,
                    property_value_amt double,
                    down_payment_amt double,
                    down_payment_pct double,
                    income_amt double,
                    self_reported_credit_txt string,
                    self_employed_ind boolean,
                    credit_history_ind boolean,
                    has_agent_ind boolean,
                    need_agent_ind boolean,
                    language_txt string,
                    loan_balance_amt double,
                    second_mortgage_ind boolean,
                    cash_out_ind boolean,
                    heloc_amt double,
                    vermont_agreed_ind boolean,
                    zgmi_contact_id string,
                    zgmi_missed_opportunity_id string,
                    zhl_lead_id string,
                    lender_matches_nb integer
                >
            ) as zgmi_connect_funnel,
            cast(
                struct(zgmi_cq_funnel.zgmi_contact_id) as struct<zgmi_contact_id string>
            ) as zgmi_cq_funnel,
            cast(
                struct(
                    zgmi_financing_cta.language_on_cta_txt,
                    zgmi_financing_cta.cta_destination_txt
                ) as struct<language_on_cta_txt string, cta_destination_txt string>
            ) as zgmi_financing_cta,
            cast(
                struct(
                    zgmi_form.form_question_txt,
                    zgmi_form.displayed_button_txt,
                    zgmi_form.version_nb
                ) as struct<
                    form_question_txt string,
                    displayed_button_txt array<string>,
                    version_nb string
                >
            ) as zgmi_form,
            cast(
                struct(
                    zgmi_lender_info.lender_id, zgmi_lender_info.number_in_list_txt
                ) as struct<lender_id string, number_in_list_txt string>
            ) as zgmi_lender_info,
            cast(
                struct(
                    zgmi_calculator.calculator_txt,
                    zgmi_calculator.estimated_monthly_payment_amt,
                    zgmi_calculator.loan_amt,
                    zgmi_calculator.down_payment_amt,
                    zgmi_calculator.down_payment_pct,
                    zgmi_calculator.loan_program_txt,
                    zgmi_calculator.interest_rt,
                    zgmi_calculator.pmi_ind,
                    zgmi_calculator.taxes_insurance_ind,
                    zgmi_calculator.property_tax_amt,
                    zgmi_calculator.property_tax_pct,
                    zgmi_calculator.home_insurance_amt,
                    zgmi_calculator.hoa_dues_amt,
                    zgmi_calculator.refinance_savings_amt,
                    zgmi_calculator.current_loan_amt,
                    zgmi_calculator.current_term_nb,
                    zgmi_calculator.origination_year_txt,
                    zgmi_calculator.new_loan_amt,
                    zgmi_calculator.new_interest_rt,
                    zgmi_calculator.new_term_nb,
                    zgmi_calculator.refinance_fees_amt,
                    zgmi_calculator.cash_out_amt,
                    zgmi_calculator.roll_fees_ind,
                    zgmi_calculator.home_affordability_amt,
                    zgmi_calculator.maximum_payment_amt,
                    zgmi_calculator.annual_income_amt,
                    zgmi_calculator.monthly_debts_amt,
                    zgmi_calculator.dti_self_reported_pct,
                    zgmi_calculator.loan_start_date_month_txt,
                    zgmi_calculator.loan_start_date_year_txt,
                    zgmi_calculator.dti_calculated_pct,
                    zgmi_calculator.total_monthly_debts_amt,
                    zgmi_calculator.mortgage_payment_amt,
                    zgmi_calculator.remaining_monthly_income_amt,
                    zgmi_calculator.min_credit_card_payments_amt,
                    zgmi_calculator.car_loan_payments_amt,
                    zgmi_calculator.student_loan_payments_amt,
                    zgmi_calculator.alimony_child_support_payments_amt,
                    zgmi_calculator.secondary_home_expenses_amt,
                    zgmi_calculator.other_loan_or_debt_payments_amt,
                    zgmi_calculator.include_utilities_ind,
                    zgmi_calculator.water_sewer_amt,
                    zgmi_calculator.gas_amt,
                    zgmi_calculator.internet_amt,
                    zgmi_calculator.electric_amt,
                    zgmi_calculator.zip_code_txt
                ) as struct<
                    calculator_txt string,
                    estimated_monthly_payment_amt double,
                    loan_amt double,
                    down_payment_amt double,
                    down_payment_pct double,
                    loan_program_txt string,
                    interest_rt double,
                    pmi_ind boolean,
                    taxes_insurance_ind boolean,
                    property_tax_amt double,
                    property_tax_pct double,
                    home_insurance_amt double,
                    hoa_dues_amt double,
                    refinance_savings_amt double,
                    current_loan_amt double,
                    current_term_nb integer,
                    origination_year_txt string,
                    new_loan_amt double,
                    new_interest_rt double,
                    new_term_nb integer,
                    refinance_fees_amt double,
                    cash_out_amt double,
                    roll_fees_ind boolean,
                    home_affordability_amt double,
                    maximum_payment_amt double,
                    annual_income_amt double,
                    monthly_debts_amt double,
                    dti_self_reported_pct double,
                    loan_start_date_month_txt string,
                    loan_start_date_year_txt string,
                    dti_calculated_pct double,
                    total_monthly_debts_amt double,
                    mortgage_payment_amt double,
                    remaining_monthly_income_amt double,
                    min_credit_card_payments_amt double,
                    car_loan_payments_amt double,
                    student_loan_payments_amt double,
                    alimony_child_support_payments_amt double,
                    secondary_home_expenses_amt double,
                    other_loan_or_debt_payments_amt double,
                    include_utilities_ind boolean,
                    water_sewer_amt double,
                    gas_amt double,
                    internet_amt double,
                    electric_amt double,
                    zip_code_txt string
                >
            ) as zgmi_calculator,
            cast(
                struct(
                    zgmi_abc_info.first_time_ind,
                    zgmi_abc_info.timeline_txt,
                    zgmi_abc_info.va_eligible_ind
                ) as struct<
                    first_time_ind boolean, timeline_txt string, va_eligible_ind boolean
                >
            ) as zgmi_abc_info,
            cast(
                struct(
                    zhl_discovery.lead_id,
                    zhl_discovery.journey_stage_cd,
                    zhl_discovery.application_type_cd,
                    zhl_discovery.variant_nm,
                    zhl_discovery.experience_nm,
                    zhl_discovery.modal_action_cd
                ) as struct<
                    lead_id string,
                    journey_stage_cd string,
                    application_type_cd string,
                    variant_nm string,
                    experience_nm string,
                    modal_action_cd string
                >
            ) as zhl_discovery,
            cast(
                struct(
                    zhl_form.form_type_cd,
                    zhl_form.form_question_txt,
                    zhl_form.displayed_button_txt,
                    zhl_form.version_nb
                ) as struct<
                    form_type_cd string,
                    form_question_txt string,
                    displayed_button_txt array<string>,
                    version_nb string
                >
            ) as zhl_form,
            cast(
                struct(
                    zhl_purchase_funnel.loan_type_txt,
                    zhl_purchase_funnel.journey_stage_txt,
                    zhl_purchase_funnel.timeline_txt,
                    zhl_purchase_funnel.city_or_zip_txt,
                    zhl_purchase_funnel.zip_code_txt,
                    zhl_purchase_funnel.state_txt,
                    zhl_purchase_funnel.city_txt,
                    zhl_purchase_funnel.county_txt,
                    zhl_purchase_funnel.county_fips_txt,
                    zhl_purchase_funnel.property_usage_txt,
                    zhl_purchase_funnel.property_type_txt,
                    zhl_purchase_funnel.loan_amt,
                    zhl_purchase_funnel.down_payment_amt,
                    zhl_purchase_funnel.down_payment_pct,
                    zhl_purchase_funnel.is_jumbo_loan_ind,
                    zhl_purchase_funnel.has_agent_ind,
                    zhl_purchase_funnel.us_citizen_ind,
                    zhl_purchase_funnel.citizenship_type_txt,
                    zhl_purchase_funnel.foreclosure_ind,
                    zhl_purchase_funnel.bankruptcy_ind,
                    zhl_purchase_funnel.first_time_buyer_ind,
                    zhl_purchase_funnel.va_ind,
                    zhl_purchase_funnel.self_reported_credit_score_txt,
                    zhl_purchase_funnel.offramp_type_txt,
                    zhl_purchase_funnel.offramp_reason_txt,
                    zhl_purchase_funnel.zgmi_contact_id,
                    zhl_purchase_funnel.zhl_lead_id,
                    zhl_purchase_funnel.zgmi_missed_opportunity_id,
                    zhl_purchase_funnel.authenticated_ind,
                    zhl_purchase_funnel.employed_ind,
                    zhl_purchase_funnel.self_employed_ind,
                    zhl_purchase_funnel.social_security_ind,
                    zhl_purchase_funnel.pension_ind,
                    zhl_purchase_funnel.other_income_ind,
                    zhl_purchase_funnel.annual_employment_income_amt,
                    zhl_purchase_funnel.annual_self_employement_income_amt,
                    zhl_purchase_funnel.annual_social_security_income_amt,
                    zhl_purchase_funnel.annual_pension_income_amt,
                    zhl_purchase_funnel.annual_other_income_amt,
                    zhl_purchase_funnel.cash_ind,
                    zhl_purchase_funnel.brokerage_ind,
                    zhl_purchase_funnel.retirement_ind,
                    zhl_purchase_funnel.other_assets_ind,
                    zhl_purchase_funnel.cash_balance_amt,
                    zhl_purchase_funnel.brokerage_balance_amt,
                    zhl_purchase_funnel.retirement_balance_amt,
                    zhl_purchase_funnel.other_assets_balance_amt,
                    zhl_purchase_funnel.credit_consent_ind,
                    zhl_purchase_funnel.dti_nb,
                    zhl_purchase_funnel.soft_credit_score_nb,
                    zhl_purchase_funnel.loan_quote_mortgage_type_txt,
                    zhl_purchase_funnel.validation_error_message_viewed_txt,
                    zhl_purchase_funnel.property_value_amt,
                    zhl_purchase_funnel.validation_error_messages_viewed,
                    zhl_purchase_funnel.zhl_loan_id,
                    zhl_purchase_funnel.dti_dupos_nb,
                    zhl_purchase_funnel.retirement_income_ind,
                    zhl_purchase_funnel.retirement_income_amt,
                    zhl_purchase_funnel.home_owner_ind,
                    zhl_purchase_funnel.selling_ind,
                    zhl_purchase_funnel.renting_ind,
                    zhl_purchase_funnel.gift_ind,
                    zhl_purchase_funnel.gift_amt,
                    zhl_purchase_funnel.agent_referred_ind,
                    zhl_purchase_funnel.homeready_homepossible_ind,
                    zhl_purchase_funnel.monthly_payment_budget_amt,
                    zhl_purchase_funnel.cash_to_close_budget_amt,
                    zhl_purchase_funnel.property_value_nb,
                    zhl_purchase_funnel.down_payment_nb,
                    zhl_purchase_funnel.annual_employment_income_nb,
                    zhl_purchase_funnel.annual_self_employement_income_nb,
                    zhl_purchase_funnel.annual_social_security_income_nb,
                    zhl_purchase_funnel.annual_pension_income_nb,
                    zhl_purchase_funnel.annual_other_income_nb,
                    zhl_purchase_funnel.gift_nb,
                    zhl_purchase_funnel.cash_balance_nb,
                    zhl_purchase_funnel.brokerage_balance_nb,
                    zhl_purchase_funnel.retirement_balance_nb,
                    zhl_purchase_funnel.other_assets_balance_nb,
                    zhl_purchase_funnel.retirement_income_nb,
                    zhl_purchase_funnel.monthly_payment_budget_nb,
                    zhl_purchase_funnel.cash_to_close_budget_nb
                ) as struct<
                    loan_type_txt string,
                    journey_stage_txt string,
                    timeline_txt string,
                    city_or_zip_txt string,
                    zip_code_txt string,
                    state_txt string,
                    city_txt string,
                    county_txt string,
                    county_fips_txt string,
                    property_usage_txt string,
                    property_type_txt string,
                    loan_amt double,
                    down_payment_amt double,
                    down_payment_pct double,
                    is_jumbo_loan_ind boolean,
                    has_agent_ind boolean,
                    us_citizen_ind boolean,
                    citizenship_type_txt string,
                    foreclosure_ind boolean,
                    bankruptcy_ind boolean,
                    first_time_buyer_ind boolean,
                    va_ind boolean,
                    self_reported_credit_score_txt string,
                    offramp_type_txt string,
                    offramp_reason_txt string,
                    zgmi_contact_id string,
                    zhl_lead_id string,
                    zgmi_missed_opportunity_id string,
                    authenticated_ind boolean,
                    employed_ind boolean,
                    self_employed_ind boolean,
                    social_security_ind boolean,
                    pension_ind boolean,
                    other_income_ind boolean,
                    annual_employment_income_amt double,
                    annual_self_employement_income_amt double,
                    annual_social_security_income_amt double,
                    annual_pension_income_amt double,
                    annual_other_income_amt double,
                    cash_ind boolean,
                    brokerage_ind boolean,
                    retirement_ind boolean,
                    other_assets_ind boolean,
                    cash_balance_amt double,
                    brokerage_balance_amt double,
                    retirement_balance_amt double,
                    other_assets_balance_amt double,
                    credit_consent_ind boolean,
                    dti_nb double,
                    soft_credit_score_nb double,
                    loan_quote_mortgage_type_txt string,
                    validation_error_message_viewed_txt string,
                    property_value_amt double,
                    validation_error_messages_viewed array<string>,
                    zhl_loan_id string,
                    dti_dupos_nb double,
                    retirement_income_ind boolean,
                    retirement_income_amt double,
                    home_owner_ind boolean,
                    selling_ind boolean,
                    renting_ind boolean,
                    gift_ind boolean,
                    gift_amt double,
                    agent_referred_ind boolean,
                    homeready_homepossible_ind boolean,
                    monthly_payment_budget_amt double,
                    cash_to_close_budget_amt double,
                    property_value_nb integer,
                    down_payment_nb integer,
                    annual_employment_income_nb integer,
                    annual_self_employement_income_nb integer,
                    annual_social_security_income_nb integer,
                    annual_pension_income_nb integer,
                    annual_other_income_nb integer,
                    gift_nb integer,
                    cash_balance_nb integer,
                    brokerage_balance_nb integer,
                    retirement_balance_nb integer,
                    other_assets_balance_nb integer,
                    retirement_income_nb integer,
                    monthly_payment_budget_nb integer,
                    cash_to_close_budget_nb integer
                >
            ) as zhl_purchase_funnel,
            cast(
                struct(
                    zhl_purchase_funnel_results.loan_quote_mortgage_type_txt,
                    zhl_purchase_funnel_results.max_home_price_amt,
                    zhl_purchase_funnel_results.monthly_payment_amt,
                    zhl_purchase_funnel_results.monthly_principal_interest_amt,
                    zhl_purchase_funnel_results.monthly_hoa_amt,
                    zhl_purchase_funnel_results.monthly_hoi_amt,
                    zhl_purchase_funnel_results.pmi_amt,
                    zhl_purchase_funnel_results.monthly_taxes_amt,
                    zhl_purchase_funnel_results.cash_to_close_amt,
                    zhl_purchase_funnel_results.down_payment_amt,
                    zhl_purchase_funnel_results.down_payment_pct,
                    zhl_purchase_funnel_results.closing_costs_amt,
                    zhl_purchase_funnel_results.loan_amt,
                    zhl_purchase_funnel_results.max_home_price_nb,
                    zhl_purchase_funnel_results.monthly_payment_nb,
                    zhl_purchase_funnel_results.monthly_principal_interest_nb,
                    zhl_purchase_funnel_results.monthly_hoa_nb,
                    zhl_purchase_funnel_results.monthly_hoi_nb,
                    zhl_purchase_funnel_results.pmi_nb,
                    zhl_purchase_funnel_results.monthly_taxes_nb,
                    zhl_purchase_funnel_results.cash_to_close_nb,
                    zhl_purchase_funnel_results.down_payment_nb,
                    zhl_purchase_funnel_results.closing_costs_nb,
                    zhl_purchase_funnel_results.loan_nb
                ) as struct<
                    loan_quote_mortgage_type_txt string,
                    max_home_price_amt double,
                    monthly_payment_amt double,
                    monthly_principal_interest_amt double,
                    monthly_hoa_amt double,
                    monthly_hoi_amt double,
                    pmi_amt double,
                    monthly_taxes_amt double,
                    cash_to_close_amt double,
                    down_payment_amt double,
                    down_payment_pct double,
                    closing_costs_amt double,
                    loan_amt double,
                    max_home_price_nb integer,
                    monthly_payment_nb integer,
                    monthly_principal_interest_nb integer,
                    monthly_hoa_nb integer,
                    monthly_hoi_nb integer,
                    pmi_nb integer,
                    monthly_taxes_nb integer,
                    cash_to_close_nb integer,
                    down_payment_nb integer,
                    closing_costs_nb integer,
                    loan_nb integer
                >
            ) as zhl_purchase_funnel_results,
            cast(
                struct(
                    zhl_refi_funnel.loan_type_txt,
                    zhl_refi_funnel.state_txt,
                    zhl_refi_funnel.property_type_txt,
                    zhl_refi_funnel.property_use_txt,
                    zhl_refi_funnel.property_value_amt,
                    zhl_refi_funnel.self_reported_credit_score_txt,
                    zhl_refi_funnel.va_eligible_ind,
                    zhl_refi_funnel.annual_income_amt,
                    zhl_refi_funnel.self_employed_ind,
                    zhl_refi_funnel.foreclosure_bankruptcy_ind,
                    zhl_refi_funnel.second_mortgage_ind,
                    zhl_refi_funnel.cash_out_ind,
                    zhl_refi_funnel.loan_balance_amt,
                    zhl_refi_funnel.zhl_lead_id
                ) as struct<
                    loan_type_txt string,
                    state_txt string,
                    property_type_txt string,
                    property_use_txt string,
                    property_value_amt double,
                    self_reported_credit_score_txt string,
                    va_eligible_ind boolean,
                    annual_income_amt double,
                    self_employed_ind boolean,
                    foreclosure_bankruptcy_ind boolean,
                    second_mortgage_ind boolean,
                    cash_out_ind boolean,
                    loan_balance_amt double,
                    zhl_lead_id string
                >
            ) as zhl_refi_funnel,
            cast(
                struct(zhl_resources_info.resource_page_title_txt) as struct<
                    resource_page_title_txt string
                >
            ) as zhl_resources_info,
            cast(
                struct(
                    financing_calculator.calculator_txt,
                    financing_calculator.estimated_monthly_payment_amt,
                    financing_calculator.property_value_amt,
                    financing_calculator.down_payment_amt,
                    financing_calculator.down_payment_pct,
                    financing_calculator.loan_program_txt,
                    financing_calculator.interest_rt,
                    financing_calculator.pmi_ind,
                    financing_calculator.taxes_insurance_ind,
                    financing_calculator.property_tax_amt,
                    financing_calculator.property_tax_pct,
                    financing_calculator.home_insurance_amt,
                    financing_calculator.hoa_dues_amt,
                    financing_calculator.refinance_savings_amt,
                    financing_calculator.current_loan_amt,
                    financing_calculator.current_term_nb,
                    financing_calculator.origination_year_txt,
                    financing_calculator.new_loan_amt,
                    financing_calculator.new_interest_rt,
                    financing_calculator.new_term_nb,
                    financing_calculator.refinance_fees_amt,
                    financing_calculator.cash_out_amt,
                    financing_calculator.roll_fees_ind,
                    financing_calculator.home_affordability_amt,
                    financing_calculator.maximum_payment_amt,
                    financing_calculator.annual_income_amt,
                    financing_calculator.monthly_debts_amt,
                    financing_calculator.dti_self_reported_pct,
                    financing_calculator.loan_start_date_month_txt,
                    financing_calculator.loan_start_date_year_txt,
                    financing_calculator.dti_calculated_pct,
                    financing_calculator.total_monthly_debts_amt,
                    financing_calculator.mortgage_payment_amt,
                    financing_calculator.remaining_monthly_income_amt,
                    financing_calculator.min_credit_card_payments_amt,
                    financing_calculator.car_loan_payments_amt,
                    financing_calculator.student_loan_payments_amt,
                    financing_calculator.alimony_child_support_payments_amt,
                    financing_calculator.secondary_home_expenses_amt,
                    financing_calculator.other_loan_or_debt_payments_amt,
                    financing_calculator.include_utilities_ind,
                    financing_calculator.water_sewer_amt,
                    financing_calculator.gas_amt,
                    financing_calculator.internet_amt,
                    financing_calculator.electric_amt,
                    financing_calculator.zip_code_txt
                ) as struct<
                    calculator_txt string,
                    estimated_monthly_payment_amt double,
                    property_value_amt double,
                    down_payment_amt double,
                    down_payment_pct double,
                    loan_program_txt string,
                    interest_rt double,
                    pmi_ind boolean,
                    taxes_insurance_ind boolean,
                    property_tax_amt double,
                    property_tax_pct double,
                    home_insurance_amt double,
                    hoa_dues_amt double,
                    refinance_savings_amt double,
                    current_loan_amt double,
                    current_term_nb integer,
                    origination_year_txt string,
                    new_loan_amt double,
                    new_interest_rt double,
                    new_term_nb integer,
                    refinance_fees_amt double,
                    cash_out_amt double,
                    roll_fees_ind boolean,
                    home_affordability_amt double,
                    maximum_payment_amt double,
                    annual_income_amt double,
                    monthly_debts_amt double,
                    dti_self_reported_pct double,
                    loan_start_date_month_txt string,
                    loan_start_date_year_txt string,
                    dti_calculated_pct double,
                    total_monthly_debts_amt double,
                    mortgage_payment_amt double,
                    remaining_monthly_income_amt double,
                    min_credit_card_payments_amt double,
                    car_loan_payments_amt double,
                    student_loan_payments_amt double,
                    alimony_child_support_payments_amt double,
                    secondary_home_expenses_amt double,
                    other_loan_or_debt_payments_amt double,
                    include_utilities_ind boolean,
                    water_sewer_amt double,
                    gas_amt double,
                    internet_amt double,
                    electric_amt double,
                    zip_code_txt string
                >
            ) as financing_calculator,
            cast(
                struct(
                    hdp_mortgage_row_details.est_payment_amt,
                    hdp_mortgage_row_details.est_payment_is_personalized,
                    hdp_mortgage_row_details.stored_down_payment_dollar_amt,
                    hdp_mortgage_row_details.stored_down_payment_percent_amt,
                    hdp_mortgage_row_details.stored_credit_score_high_amt,
                    hdp_mortgage_row_details.stored_credit_score_low_amt,
                    hdp_mortgage_row_details.rate_source_txt,
                    hdp_mortgage_row_details.disclaimer_txt,
                    hdp_mortgage_row_details.experiment_trial_txt,
                    hdp_mortgage_row_details.experiment_treatment_txt,
                    hdp_mortgage_row_details.error_reason_txt
                ) as struct<
                    est_payment_amt double,
                    est_payment_is_personalized boolean,
                    stored_down_payment_dollar_amt double,
                    stored_down_payment_percent_amt double,
                    stored_credit_score_high_amt double,
                    stored_credit_score_low_amt double,
                    rate_source_txt string,
                    disclaimer_txt string,
                    experiment_trial_txt string,
                    experiment_treatment_txt string,
                    error_reason_txt string
                >
            ) as hdp_mortgage_row_details,
            cast(
                struct(
                    personalized_payment_modal_details.est_payment_amt,
                    personalized_payment_modal_details.est_payment_is_personalized,
                    personalized_payment_modal_details.stored_down_payment_dollar_amt,
                    personalized_payment_modal_details.stored_down_payment_percent_amt,
                    personalized_payment_modal_details.stored_credit_score_high_amt,
                    personalized_payment_modal_details.stored_credit_score_low_amt,
                    personalized_payment_modal_details.rate_source_txt,
                    personalized_payment_modal_details.disclaimer_txt,
                    personalized_payment_modal_details.experiment_trial_txt,
                    personalized_payment_modal_details.experiment_treatment_txt,
                    personalized_payment_modal_details.input_down_payment_preference_txt,
                    personalized_payment_modal_details.input_down_payment_dollar_amt,
                    personalized_payment_modal_details.input_down_payment_percent_amt,
                    personalized_payment_modal_details.input_credit_score_high_amt,
                    personalized_payment_modal_details.input_credit_score_low_amt,
                    personalized_payment_modal_details.tooltip_location_txt,
                    personalized_payment_modal_details.error_reason_txt
                ) as struct<
                    est_payment_amt double,
                    est_payment_is_personalized boolean,
                    stored_down_payment_dollar_amt double,
                    stored_down_payment_percent_amt double,
                    stored_credit_score_high_amt double,
                    stored_credit_score_low_amt double,
                    rate_source_txt string,
                    disclaimer_txt string,
                    experiment_trial_txt string,
                    experiment_treatment_txt string,
                    input_down_payment_preference_txt string,
                    input_down_payment_dollar_amt double,
                    input_down_payment_percent_amt double,
                    input_credit_score_high_amt double,
                    input_credit_score_low_amt double,
                    tooltip_location_txt string,
                    error_reason_txt string
                >
            ) as personalized_payment_modal_details,
            cast(
                struct(
                    zhl_verify_summary_counts.employer_income_cnt,
                    zhl_verify_summary_counts.checking_account_cnt,
                    zhl_verify_summary_counts.savings_account_cnt,
                    zhl_verify_summary_counts.money_market_account_cnt,
                    zhl_verify_summary_counts.cd_account_cnt,
                    zhl_verify_summary_counts.stock_account_cnt,
                    zhl_verify_summary_counts.stock_options_account_cnt,
                    zhl_verify_summary_counts.bonds_account_cnt,
                    zhl_verify_summary_counts.mutual_funds_cnt,
                    zhl_verify_summary_counts.retirement_account_cnt,
                    zhl_verify_summary_counts.w2_tasks_cnt,
                    zhl_verify_summary_counts.paystub_tasks_cnt,
                    zhl_verify_summary_counts.bank_statement_tasks_cnt
                ) as struct<
                    employer_income_cnt integer,
                    checking_account_cnt integer,
                    savings_account_cnt integer,
                    money_market_account_cnt integer,
                    cd_account_cnt integer,
                    stock_account_cnt integer,
                    stock_options_account_cnt integer,
                    bonds_account_cnt integer,
                    mutual_funds_cnt integer,
                    retirement_account_cnt integer,
                    w2_tasks_cnt integer,
                    paystub_tasks_cnt integer,
                    bank_statement_tasks_cnt integer
                >
            ) as zhl_verify_summary_counts,
            cast(
                struct(
                    zhl_purchase_verify.zhl_lead_id,
                    zhl_purchase_verify.zhl_loan_id,
                    zhl_purchase_verify.zhl_preapproval_status_txt
                ) as struct<
                    zhl_lead_id string,
                    zhl_loan_id string,
                    zhl_preapproval_status_txt string
                >
            ) as zhl_purchase_verify,
            cast(
                struct(
                    buying_power.config_ind,
                    buying_power.module_state_txt,
                    buying_power.button_txt,
                    buying_power.button_destination_txt,
                    buying_power.button_helper_txt,
                    buying_power.is_error_ind,
                    buying_power.field_with_error_txt,
                    buying_power.error_txt,
                    buying_power.location_input_type_txt,
                    buying_power.input_entered_ind,
                    buying_power.input_field_nm,
                    buying_power.input_field_txt,
                    buying_power.tooltip_nm_txt,
                    buying_power.error_nm_txt,
                    buying_power.button_nm_txt,
                    buying_power.is_zhl_rate_ind
                ) as struct<
                    config_ind boolean,
                    module_state_txt string,
                    button_txt string,
                    button_destination_txt string,
                    button_helper_txt string,
                    is_error_ind boolean,
                    field_with_error_txt string,
                    error_txt string,
                    location_input_type_txt string,
                    input_entered_ind boolean,
                    input_field_nm string,
                    input_field_txt string,
                    tooltip_nm_txt string,
                    error_nm_txt string,
                    button_nm_txt string,
                    is_zhl_rate_ind boolean
                >
            ) as buying_power,
            cast(
                struct(
                    device_info.device_category_nm,
                    device_info.device_type_nm,
                    device_info.screen_resolution_txt,
                    device_info.device_nm,
                    device_info.device_manufacturer_nm,
                    device_info.device_model_nm,
                    device_info.os_nm,
                    device_info.os_version_id,
                    device_info.browser_nm,
                    device_info.language_cd,
                    device_info.country_nm,
                    device_info.state_cd,
                    device_info.city_nm,
                    device_info.zip_cd,
                    device_info.longitude_nb,
                    device_info.latitude_nb,
                    device_info.device_timezone_cd,
                    device_info.dma_txt,
                    device_info.dma_nm,
                    device_info.msa_nm,
                    device_info.region_nm,
                    device_info.browser_type_nm
                ) as struct<
                    device_category_nm string,
                    device_type_nm string,
                    screen_resolution_txt string,
                    device_nm string,
                    device_manufacturer_nm string,
                    device_model_nm string,
                    os_nm string,
                    os_version_id string,
                    browser_nm string,
                    language_cd string,
                    country_nm string,
                    state_cd string,
                    city_nm string,
                    zip_cd string,
                    longitude_nb double,
                    latitude_nb double,
                    device_timezone_cd string,
                    dma_txt string,
                    dma_nm string,
                    msa_nm string,
                    region_nm string,
                    browser_type_nm string
                >
            ) as device_info,
            cast(
                struct(
                    property_info.zpid,
                    property_info.lot_id,
                    property_info.saved_ind,
                    property_info.imx_ind,
                    property_info.imx_2_ind,
                    property_info.tour_3d_ind,
                    property_info.similar_homes_zpids,
                    property_info.homes_for_you_zpids,
                    property_info.lot_ids,
                    property_info.other_available_plans_zpids,
                    property_info.similar_rentals_zpids,
                    property_info.nearby_homes_zpids,
                    property_info.nearby_rentals_zpids,
                    property_info.homes_in_community,
                    property_info.matterport_ind,
                    property_info.zillow_owned_exp_ind,
                    property_info.showcase_hdp_ind,
                    property_info.third_party_vt_ind,
                    property_info.video_ind,
                    property_info.target_property_zpid,
                    property_info.target_community_plid,
                    property_info.provider_listing_id,
                    property_info.raw_home_status_cd,
                    property_info.display_status_cd,
                    property_info.marketing_status_simplified_cd,
                    property_info.is_paid_ind,
                    property_info.state_cd,
                    property_info.county_nm,
                    property_info.city_nm,
                    property_info.zip_cd,
                    property_info.street_address_txt,
                    property_info.price_amt,
                    property_info.listing_status_cd,
                    property_info.listing_type_cd,
                    property_info.latitude_nb,
                    property_info.longitude_nb,
                    property_info.city_id,
                    property_info.state_id,
                    property_info.bath_cnt,
                    property_info.bedroom_cnt,
                    property_info.sqft_nb,
                    property_info.year_built_nb,
                    property_info.lot_size_acre_nb,
                    property_info.home_type_cd,
                    property_info.story_cnt_nb,
                    property_info.mpid,
                    property_info.school_district_nm,
                    property_info.listing_ts,
                    property_info.photo_cnt,
                    property_info.property_dsc,
                    property_info.enrichment_ts,
                    property_info.enrichment_source_nm,
                    property_info.currency_type_cd,
                    property_info.county_id,
                    property_info.neighborhood_id,
                    property_info.country_cd,
                    property_info.displayed_highlights,
                    property_info.fixture_classification_cd,
                    property_info.hdp_showcase_ind,
                    property_info.is_owner_occupied_ind,
                    property_info.nearby_rental_homes_impression_zpids,
                    property_info.provider_category_cd,
                    property_info.foreclosure_stage_cd,
                    property_info.broker_id,
                    property_info.room_for_rent_ind,
                    property_info.tracing_id,
                    property_info.pdc_home_type_txt,
                    property_info.tour_url_txt,
                    property_info.property_tracing_id,
                    property_info.zipcode_id
                ) as struct<
                    zpid integer,
                    lot_id string,
                    saved_ind boolean,
                    imx_ind boolean,
                    imx_2_ind boolean,
                    tour_3d_ind boolean,
                    similar_homes_zpids array<integer>,
                    homes_for_you_zpids array<integer>,
                    lot_ids array<integer>,
                    other_available_plans_zpids array<integer>,
                    similar_rentals_zpids array<integer>,
                    nearby_homes_zpids array<integer>,
                    nearby_rentals_zpids array<integer>,
                    homes_in_community array<integer>,
                    matterport_ind boolean,
                    zillow_owned_exp_ind boolean,
                    showcase_hdp_ind boolean,
                    third_party_vt_ind boolean,
                    video_ind boolean,
                    target_property_zpid integer,
                    target_community_plid string,
                    provider_listing_id string,
                    raw_home_status_cd string,
                    display_status_cd string,
                    marketing_status_simplified_cd string,
                    is_paid_ind boolean,
                    state_cd string,
                    county_nm string,
                    city_nm string,
                    zip_cd string,
                    street_address_txt string,
                    price_amt integer,
                    listing_status_cd string,
                    listing_type_cd string,
                    latitude_nb double,
                    longitude_nb double,
                    city_id integer,
                    state_id integer,
                    bath_cnt real,
                    bedroom_cnt integer,
                    sqft_nb double,
                    year_built_nb string,
                    lot_size_acre_nb double,
                    home_type_cd string,
                    story_cnt_nb real,
                    mpid bigint,
                    school_district_nm string,
                    listing_ts string,
                    photo_cnt integer,
                    property_dsc string,
                    enrichment_ts string,
                    enrichment_source_nm string,
                    currency_type_cd string,
                    county_id integer,
                    neighborhood_id integer,
                    country_cd string,
                    displayed_highlights array<string>,
                    fixture_classification_cd string,
                    hdp_showcase_ind boolean,
                    is_owner_occupied_ind boolean,
                    nearby_rental_homes_impression_zpids array<integer>,
                    provider_category_cd string,
                    foreclosure_stage_cd string,
                    broker_id string,
                    room_for_rent_ind boolean,
                    tracing_id integer,
                    pdc_home_type_txt string,
                    tour_url_txt string,
                    property_tracing_id string,
                    zipcode_id integer
                >
            ) as property_info,
            brand_cd,
            platform_nm,
            from_utc_timestamp(current_timestamp(), 'PST') as update_timestamp_pst,
            current_date record_update_dt,
            cast(
                struct(
                    cms_info.taxonomy_target_personas_txt,
                    cms_info.taxonomy_target_brands_txt,
                    cms_info.taxonomy_categories_txt,
                    cms_info.taxonomy_tags_txt,
                    cms_info.agent_type_txt,
                    cms_info.block_id,
                    cms_info.block_type_cd,
                    cms_info.block_displayed_txt,
                    cms_info.block_target_url,
                    cms_info.block_target_window_txt,
                    cms_info.block_slide_nb,
                    cms_info.block_media_host_txt,
                    cms_info.block_media_url,
                    cms_info.apex_business_line_txt,
                    cms_info.apex_warm_lead_source_txt,
                    cms_info.apex_form_is_valid_ind,
                    cms_info.apex_invalid_fields_txt,
                    cms_info.apex_submit_success_ind,
                    cms_info.apex_server_response_message_txt,
                    cms_info.apex_sms_txt,
                    cms_info.apex_submit_label_txt,
                    cms_info.apex_mobile_submit_label_txt,
                    cms_info.apex_mobile_url,
                    cms_info.content_location_scroll_depth_percentage_nb,
                    cms_info.content_location_scroll_depth_pixels_nb,
                    cms_info.content_location_scroll_depth_page_height_nb,
                    cms_info.form_business_line_txt,
                    cms_info.form_warm_lead_source_txt,
                    cms_info.form_is_valid_ind,
                    cms_info.form_invalid_fields_txt,
                    cms_info.form_submit_success_ind,
                    cms_info.form_server_response_message_txt,
                    cms_info.form_sms_txt,
                    cms_info.form_submit_label_txt,
                    cms_info.form_mobile_submit_label_txt,
                    cms_info.form_mobile_url
                ) as struct<
                    taxonomy_target_personas_txt array<string>,
                    taxonomy_target_brands_txt array<string>,
                    taxonomy_categories_txt array<string>,
                    taxonomy_tags_txt array<string>,
                    agent_type_txt string,
                    block_id string,
                    block_type_cd string,
                    block_displayed_txt string,
                    block_target_url string,
                    block_target_window_txt string,
                    block_slide_nb double,
                    block_media_host_txt string,
                    block_media_url string,
                    apex_business_line_txt string,
                    apex_warm_lead_source_txt string,
                    apex_form_is_valid_ind boolean,
                    apex_invalid_fields_txt array<string>,
                    apex_submit_success_ind boolean,
                    apex_server_response_message_txt string,
                    apex_sms_txt string,
                    apex_submit_label_txt string,
                    apex_mobile_submit_label_txt string,
                    apex_mobile_url string,
                    content_location_scroll_depth_percentage_nb double,
                    content_location_scroll_depth_pixels_nb double,
                    content_location_scroll_depth_page_height_nb double,
                    form_business_line_txt string,
                    form_warm_lead_source_txt string,
                    form_is_valid_ind boolean,
                    form_invalid_fields_txt array<string>,
                    form_submit_success_ind boolean,
                    form_server_response_message_txt string,
                    form_sms_txt string,
                    form_submit_label_tx string,
                    form_mobile_submit_label_txt string,
                    form_mobile_url string
                >
            ) as cms_info,
            cast(
                struct(
                    illuminate_home_loans.has_loan_ind,
                    illuminate_home_loans.selected_resource_txt
                ) as struct<has_loan_ind boolean, selected_resource_txt string>
            ) as illuminate_home_loans
        from {{ source("clickstream", "daily_mobile_nopii") }}
        where
            brand_cd = 'zillow'
            and cast(client_data_pst_dt as date)
            = date_add(cast("{{ var('process_date') }}" as date), -1)
            /* exclude largest event id with exceptions */
            and envelope.event_type_id
            not in (select event_type_id from clickstream_event_registry_exclusions)
    ),

    daily_web_nopii as (
        select
            client_ts,
            client_data_pst_dt,
            cast(
                struct(
                    envelope.event_type_id,
                    envelope.event_uuid,
                    envelope.event_client_start_dtm
                ) as struct<
                    event_type_id string,
                    event_uuid string,
                    event_client_start_dtm string
                >
            ) as envelope,
            cast(
                struct(semantic.semantic_event_nm, semantic.topic_tag_txt) as struct<
                    semantic_event_nm string, topic_tag_txt array<string>
                >
            ) as semantic,
            cast(
                struct(
                    clickstream_trigger.trigger_location_nm,
                    clickstream_trigger.trigger_type_nm,
                    clickstream_trigger.trigger_object_nm,
                    clickstream_trigger.trigger_source_nm,
                    clickstream_trigger.screen_display_title_nm,
                    clickstream_trigger.trigger_reference_url,
                    clickstream_trigger.trigger_subdomain_nm,
                    clickstream_trigger.trigger_path_nm,
                    clickstream_trigger.input_selector_nm,
                    clickstream_trigger.referral_url,
                    clickstream_trigger.itc_parameters,
                    clickstream_trigger.itc_parameters_txt
                ) as struct<
                    trigger_location_nm string,
                    trigger_type_nm string,
                    trigger_object_nm string,
                    trigger_source_nm string,
                    screen_display_title_nm string,
                    trigger_reference_url string,
                    trigger_subdomain_nm string,
                    trigger_path_nm string,
                    input_selector_nm string,
                    referral_url string,
                    itc_parameters string,
                    itc_parameters_txt string
                >
            ) as clickstream_trigger,
            cast(
                struct(
                    user_info.pii_join_key,
                    user_info.zuid,
                    user_info.guid,
                    user_info.first_visit_dt,
                    user_info.bot_ind,
                    user_info.internal_zillow_group_user_ind,
                    user_info.webview_guid
                ) as struct<
                    pii_join_key string,
                    zuid string,
                    guid string,
                    first_visit_dt string,
                    bot_ind boolean,
                    internal_zillow_group_user_ind boolean,
                    webview_guid string
                >
            ) as user_info,
            cast(
                struct(
                    event_enrichment.event_nb, event_enrichment.screen_view_nb
                ) as struct<event_nb integer, screen_view_nb integer>
            ) as event_enrichment,
            cast(
                struct(
                    content_page.displayed_button_txt,
                    content_page.displayed_field_txt
                ) as struct<
                    displayed_button_txt array<string>,
                    displayed_field_txt array<string>
                >
            ) as content_page,
            cast(
                struct(
                    app_info.app_type_nm,
                    app_info.app_nm,
                    app_info.app_version_id,
                    app_info.app_ns,
                    app_info.app_bld,
                    app_info.sdk_nm,
                    app_info.sdk_version_id,
                    app_info.environment_nm
                ) as struct<
                    app_type_nm string,
                    app_nm string,
                    app_version_id string,
                    app_ns string,
                    app_bld string,
                    sdk_nm string,
                    sdk_version_id string,
                    environment_nm string
                >
            ) as app_info,
            cast(
                struct(
                    cross_domain_tracking.zillow_guid,
                    cross_domain_tracking.zillow_saved_ts,
                    cross_domain_tracking.zillow_uid,
                    cross_domain_tracking.zhl_guid,
                    cross_domain_tracking.zhl_uid,
                    cross_domain_tracking.zhl_saved_ts
                ) as struct<
                    zillow_guid string,
                    zillow_saved_ts string,
                    zillow_uid string,
                    zhl_guid string,
                    zhl_uid string,
                    zhl_saved_ts string
                >
            ) as cross_domain_tracking,
            cast(
                struct(
                    user_session_enrichment.session_id,
                    user_session_enrichment.original_session_id,
                    user_session_enrichment.event_client_start_pst_dtm,
                    user_session_enrichment.session_start_pst_dtm,
                    user_session_enrichment.session_end_pst_dtm
                ) as struct<
                    session_id string,
                    original_session_id string,
                    event_client_start_pst_dtm string,
                    session_start_pst_dtm string,
                    session_end_pst_dtm string
                >
            ) as user_session_enrichment,
            cast(
                struct(
                    exposure.randomization_key,
                    exposure.key_type_cd,
                    exposure.decision_token_id,
                    exposure.treatment_nm,
                    exposure.assignment_service_cd,
                    exposure.extended_info_txt
                ) as struct<
                    randomization_key string,
                    key_type_cd string,
                    decision_token_id string,
                    treatment_nm array<string>,
                    assignment_service_cd string,
                    extended_info_txt string
                >
            ) as exposure,
            cast(
                struct(
                    marketing_info.referral_url,
                    marketing_info.utm_source_nm,
                    marketing_info.utm_medium_nm,
                    marketing_info.utm_campaign_nm,
                    marketing_info.utm_term_nm,
                    marketing_info.utm_content_nm,
                    marketing_info.channel_grouping,
                    marketing_info.campaign_id,
                    marketing_info.campaign_cd
                ) as struct<
                    referral_url string,
                    utm_source_nm string,
                    utm_medium_nm string,
                    utm_campaign_nm string,
                    utm_term_nm string,
                    utm_content_nm string,
                    channel_grouping string,
                    campaign_id string,
                    campaign_cd string
                >
            ) as marketing_info,
            cast(
                struct(
                    session_marketing_info.referral_url,
                    session_marketing_info.utm_source_nm,
                    session_marketing_info.utm_medium_nm,
                    session_marketing_info.utm_campaign_nm,
                    session_marketing_info.utm_term_nm,
                    session_marketing_info.utm_content_nm,
                    session_marketing_info.channel_grouping,
                    session_marketing_info.campaign_id,
                    session_marketing_info.campaign_cd
                ) as struct<
                    referral_url string,
                    utm_source_nm string,
                    utm_medium_nm string,
                    utm_campaign_nm string,
                    utm_term_nm string,
                    utm_content_nm string,
                    channel_grouping string,
                    campaign_id string,
                    campaign_cd string
                >
            ) as session_marketing_info,
            cast(
                struct(
                    top_navigation.target_url,
                    top_navigation.level_one_txt,
                    top_navigation.level_two_txt,
                    top_navigation.level_three_txt
                ) as struct<
                    target_url string,
                    level_one_txt string,
                    level_two_txt string,
                    level_three_txt string
                >
            ) as top_navigation,
            cast(
                struct(
                    abad_info.abad_context_txt,
                    abad_info.abad_version_nb,
                    abad_info.abad_close_button_txt
                ) as struct<
                    abad_context_txt string,
                    abad_version_nb integer,
                    abad_close_button_txt string
                >
            ) as abad_info,
            cast(
                struct(
                    contact_request_form.title_txt,
                    contact_request_form.form_id,
                    contact_request_form.variant_txt,
                    contact_request_form.version_nb,
                    contact_request_form.displayed_button_txt,
                    contact_request_form.displayed_field_txt,
                    contact_request_form.finance_ind,
                    contact_request_form.agent_transfer_ind,
                    contact_request_form.pa_lead_id,
                    contact_request_form.tour_type_txt,
                    contact_request_form.my_agent_relationship_id,
                    contact_request_form.appointment_hash_txt,
                    contact_request_form.tour_status_txt,
                    contact_request_form.tour_notes_ind,
                    contact_request_form.tour_feedback_question_txt
                ) as struct<
                    title_txt string,
                    form_id string,
                    variant_txt string,
                    version_nb string,
                    displayed_button_txt string,
                    displayed_field_txt string,
                    finance_ind boolean,
                    agent_transfer_ind boolean,
                    pa_lead_id string,
                    tour_type_txt string,
                    my_agent_relationship_id string,
                    appointment_hash_txt string,
                    tour_status_txt string,
                    tour_notes_ind boolean,
                    tour_feedback_question_txt string
                >
            ) as contact_request_form,
            cast(
                struct(
                    financing_cta.language_on_cta_txt,
                    financing_cta.cta_destination_txt,
                    financing_cta.est_payment_amt,
                    financing_cta.rate_source_txt,
                    financing_cta.disclaimer_txt,
                    financing_cta.experiment_trial_txt,
                    financing_cta.experiment_treatment_txt
                ) as struct<
                    language_on_cta_txt string,
                    cta_destination_txt string,
                    est_payment_amt double,
                    rate_source_txt string,
                    disclaimer_txt string,
                    experiment_trial_txt string,
                    experiment_treatment_txt string
                >
            ) as financing_cta,
            cast(
                struct(
                    form_interaction_info.interaction_type_txt,
                    form_interaction_info.question_txt,
                    form_interaction_info.field_name_txt
                ) as struct<
                    interaction_type_txt string,
                    question_txt string,
                    field_name_txt string
                >
            ) as form_interaction_info,
            cast(
                struct(miso_dashboard.miso_id, miso_dashboard.zpid) as struct<
                    miso_id string, zpid integer
                >
            ) as miso_dashboard,
            cast(
                struct(miso_questionnaire.miso_id, miso_questionnaire.zpid) as struct<
                    miso_id string, zpid integer
                >
            ) as miso_questionnaire,
            cast(
                struct(
                    omp.event_type_nm,
                    omp.skip_display_reason_txt,
                    omp.should_display_ind,
                    omp.global_holdout_ind,
                    omp.placement_holdout_ind,
                    omp.placement_nm,
                    omp.test_phase_nm,
                    omp.bucket_nm,
                    omp.placement_id,
                    omp.throttle_pass_ind,
                    omp.last_modified_dtm,
                    omp.event_id,
                    omp.decision_context_guid,
                    omp.decision_context_encoded_zuid,
                    omp.selected_treatment_id,
                    omp.selected_treatment_nm,
                    omp.selected_treatment_status_cd,
                    omp.selected_treatment_last_modified_dtm,
                    omp.selected_treatment_lob_nm,
                    omp.selected_treatment_experiment_family_nm,
                    omp.selected_treatment_experiment_iteration_txt,
                    omp.selected_treatment_variation_nm,
                    omp.qualified_treatment_portfolio_nm,
                    omp.qualified_treatment_portfolio_test_nm,
                    omp.qualified_treatment_target_selection_nm,
                    omp.qualified_treatment_baseline_evaluation_nm
                ) as struct<
                    event_type_nm string,
                    skip_display_reason_txt string,
                    should_display_ind boolean,
                    global_holdout_ind boolean,
                    placement_holdout_ind boolean,
                    placement_nm string,
                    test_phase_nm string,
                    bucket_nm string,
                    placement_id integer,
                    throttle_pass_ind boolean,
                    last_modified_dtm string,
                    event_id string,
                    decision_context_guid string,
                    decision_context_encoded_zuid string,
                    selected_treatment_id integer,
                    selected_treatment_nm string,
                    selected_treatment_status_cd string,
                    selected_treatment_last_modified_dtm string,
                    selected_treatment_lob_nm string,
                    selected_treatment_experiment_family_nm string,
                    selected_treatment_experiment_iteration_txt string,
                    selected_treatment_variation_nm string,
                    qualified_treatment_portfolio_nm array<string>,
                    qualified_treatment_portfolio_test_nm array<string>,
                    qualified_treatment_target_selection_nm array<string>,
                    qualified_treatment_baseline_evaluation_nm array<string>
                >
            ) as omp,
            cast(
                struct(
                    premier_agent_contact.contact_id,
                    premier_agent_contact.current_contact_status_txt,
                    premier_agent_contact.target_contact_status_txt,
                    premier_agent_contact.transaction_id
                ) as struct<
                    contact_id integer,
                    current_contact_status_txt string,
                    target_contact_status_txt string,
                    transaction_id string
                >
            ) as premier_agent_contact,
            cast(
                struct(
                    zgmi_connect_funnel.connect_version_txt,
                    zgmi_connect_funnel.city_or_zip_txt,
                    zgmi_connect_funnel.zip_code_txt,
                    zgmi_connect_funnel.state_txt,
                    zgmi_connect_funnel.city_txt,
                    zgmi_connect_funnel.county_txt,
                    zgmi_connect_funnel.county_fips_txt,
                    zgmi_connect_funnel.loan_type_txt,
                    zgmi_connect_funnel.first_time_ind,
                    zgmi_connect_funnel.home_owner_ind,
                    zgmi_connect_funnel.selling_ind,
                    zgmi_connect_funnel.journey_stage_txt,
                    zgmi_connect_funnel.needs_txt,
                    zgmi_connect_funnel.property_type_txt,
                    zgmi_connect_funnel.property_usage_txt,
                    zgmi_connect_funnel.va_eligible_ind,
                    zgmi_connect_funnel.property_value_amt,
                    zgmi_connect_funnel.down_payment_amt,
                    zgmi_connect_funnel.down_payment_pct,
                    zgmi_connect_funnel.income_amt,
                    zgmi_connect_funnel.self_reported_credit_txt,
                    zgmi_connect_funnel.self_employed_ind,
                    zgmi_connect_funnel.credit_history_ind,
                    zgmi_connect_funnel.has_agent_ind,
                    zgmi_connect_funnel.need_agent_ind,
                    zgmi_connect_funnel.language_txt,
                    zgmi_connect_funnel.loan_balance_amt,
                    zgmi_connect_funnel.second_mortgage_ind,
                    zgmi_connect_funnel.cash_out_ind,
                    zgmi_connect_funnel.heloc_amt,
                    zgmi_connect_funnel.vermont_agreed_ind,
                    zgmi_connect_funnel.zgmi_contact_id,
                    zgmi_connect_funnel.zgmi_missed_opportunity_id,
                    zgmi_connect_funnel.zhl_lead_id,
                    zgmi_connect_funnel.lender_matches_nb
                ) as struct<
                    connect_version_txt string,
                    city_or_zip_txt string,
                    zip_code_txt string,
                    state_txt string,
                    city_txt string,
                    county_txt string,
                    county_fips_txt string,
                    loan_type_txt string,
                    first_time_ind boolean,
                    home_owner_ind boolean,
                    selling_ind boolean,
                    journey_stage_txt string,
                    needs_txt string,
                    property_type_txt string,
                    property_usage_txt string,
                    va_eligible_ind boolean,
                    property_value_amt double,
                    down_payment_amt double,
                    down_payment_pct double,
                    income_amt double,
                    self_reported_credit_txt string,
                    self_employed_ind boolean,
                    credit_history_ind boolean,
                    has_agent_ind boolean,
                    need_agent_ind boolean,
                    language_txt string,
                    loan_balance_amt double,
                    second_mortgage_ind boolean,
                    cash_out_ind boolean,
                    heloc_amt double,
                    vermont_agreed_ind boolean,
                    zgmi_contact_id string,
                    zgmi_missed_opportunity_id string,
                    zhl_lead_id string,
                    lender_matches_nb integer
                >
            ) as zgmi_connect_funnel,
            cast(
                struct(zgmi_cq_funnel.zgmi_contact_id) as struct<zgmi_contact_id string>
            ) as zgmi_cq_funnel,
            cast(
                struct(
                    zgmi_financing_cta.language_on_cta_txt,
                    zgmi_financing_cta.cta_destination_txt
                ) as struct<language_on_cta_txt string, cta_destination_txt string>
            ) as zgmi_financing_cta,
            cast(
                struct(
                    zgmi_form.form_question_txt,
                    zgmi_form.displayed_button_txt,
                    zgmi_form.version_nb
                ) as struct<
                    form_question_txt string,
                    displayed_button_txt array<string>,
                    version_nb string
                >
            ) as zgmi_form,
            cast(
                struct(
                    zgmi_lender_info.lender_id, zgmi_lender_info.number_in_list_txt
                ) as struct<lender_id string, number_in_list_txt string>
            ) as zgmi_lender_info,
            cast(
                struct(
                    zgmi_calculator.calculator_txt,
                    zgmi_calculator.estimated_monthly_payment_amt,
                    zgmi_calculator.loan_amt,
                    zgmi_calculator.down_payment_amt,
                    zgmi_calculator.down_payment_pct,
                    zgmi_calculator.loan_program_txt,
                    zgmi_calculator.interest_rt,
                    zgmi_calculator.pmi_ind,
                    zgmi_calculator.taxes_insurance_ind,
                    zgmi_calculator.property_tax_amt,
                    zgmi_calculator.property_tax_pct,
                    zgmi_calculator.home_insurance_amt,
                    zgmi_calculator.hoa_dues_amt,
                    zgmi_calculator.refinance_savings_amt,
                    zgmi_calculator.current_loan_amt,
                    zgmi_calculator.current_term_nb,
                    zgmi_calculator.origination_year_txt,
                    zgmi_calculator.new_loan_amt,
                    zgmi_calculator.new_interest_rt,
                    zgmi_calculator.new_term_nb,
                    zgmi_calculator.refinance_fees_amt,
                    zgmi_calculator.cash_out_amt,
                    zgmi_calculator.roll_fees_ind,
                    zgmi_calculator.home_affordability_amt,
                    zgmi_calculator.maximum_payment_amt,
                    zgmi_calculator.annual_income_amt,
                    zgmi_calculator.monthly_debts_amt,
                    zgmi_calculator.dti_self_reported_pct,
                    zgmi_calculator.loan_start_date_month_txt,
                    zgmi_calculator.loan_start_date_year_txt,
                    zgmi_calculator.dti_calculated_pct,
                    zgmi_calculator.total_monthly_debts_amt,
                    zgmi_calculator.mortgage_payment_amt,
                    zgmi_calculator.remaining_monthly_income_amt,
                    zgmi_calculator.min_credit_card_payments_amt,
                    zgmi_calculator.car_loan_payments_amt,
                    zgmi_calculator.student_loan_payments_amt,
                    zgmi_calculator.alimony_child_support_payments_amt,
                    zgmi_calculator.secondary_home_expenses_amt,
                    zgmi_calculator.other_loan_or_debt_payments_amt,
                    zgmi_calculator.include_utilities_ind,
                    zgmi_calculator.water_sewer_amt,
                    zgmi_calculator.gas_amt,
                    zgmi_calculator.internet_amt,
                    zgmi_calculator.electric_amt,
                    zgmi_calculator.zip_code_txt
                ) as struct<
                    calculator_txt string,
                    estimated_monthly_payment_amt double,
                    loan_amt double,
                    down_payment_amt double,
                    down_payment_pct double,
                    loan_program_txt string,
                    interest_rt double,
                    pmi_ind boolean,
                    taxes_insurance_ind boolean,
                    property_tax_amt double,
                    property_tax_pct double,
                    home_insurance_amt double,
                    hoa_dues_amt double,
                    refinance_savings_amt double,
                    current_loan_amt double,
                    current_term_nb integer,
                    origination_year_txt string,
                    new_loan_amt double,
                    new_interest_rt double,
                    new_term_nb integer,
                    refinance_fees_amt double,
                    cash_out_amt double,
                    roll_fees_ind boolean,
                    home_affordability_amt double,
                    maximum_payment_amt double,
                    annual_income_amt double,
                    monthly_debts_amt double,
                    dti_self_reported_pct double,
                    loan_start_date_month_txt string,
                    loan_start_date_year_txt string,
                    dti_calculated_pct double,
                    total_monthly_debts_amt double,
                    mortgage_payment_amt double,
                    remaining_monthly_income_amt double,
                    min_credit_card_payments_amt double,
                    car_loan_payments_amt double,
                    student_loan_payments_amt double,
                    alimony_child_support_payments_amt double,
                    secondary_home_expenses_amt double,
                    other_loan_or_debt_payments_amt double,
                    include_utilities_ind boolean,
                    water_sewer_amt double,
                    gas_amt double,
                    internet_amt double,
                    electric_amt double,
                    zip_code_txt string
                >
            ) as zgmi_calculator,
            cast(
                struct(
                    zgmi_abc_info.first_time_ind,
                    zgmi_abc_info.timeline_txt,
                    zgmi_abc_info.va_eligible_ind
                ) as struct<
                    first_time_ind boolean, timeline_txt string, va_eligible_ind boolean
                >
            ) as zgmi_abc_info,
            cast(
                struct(
                    zhl_discovery.lead_id,
                    zhl_discovery.journey_stage_cd,
                    zhl_discovery.application_type_cd,
                    zhl_discovery.variant_nm,
                    zhl_discovery.experience_nm,
                    zhl_discovery.modal_action_cd
                ) as struct<
                    lead_id string,
                    journey_stage_cd string,
                    application_type_cd string,
                    variant_nm string,
                    experience_nm string,
                    modal_action_cd string
                >
            ) as zhl_discovery,
            cast(
                struct(
                    zhl_form.form_type_cd,
                    zhl_form.form_question_txt,
                    zhl_form.displayed_button_txt,
                    zhl_form.version_nb
                ) as struct<
                    form_type_cd string,
                    form_question_txt string,
                    displayed_button_txt array<string>,
                    version_nb string
                >
            ) as zhl_form,
            cast(
                struct(
                    zhl_purchase_funnel.loan_type_txt,
                    zhl_purchase_funnel.journey_stage_txt,
                    zhl_purchase_funnel.timeline_txt,
                    zhl_purchase_funnel.city_or_zip_txt,
                    zhl_purchase_funnel.zip_code_txt,
                    zhl_purchase_funnel.state_txt,
                    zhl_purchase_funnel.city_txt,
                    zhl_purchase_funnel.county_txt,
                    zhl_purchase_funnel.county_fips_txt,
                    zhl_purchase_funnel.property_usage_txt,
                    zhl_purchase_funnel.property_type_txt,
                    zhl_purchase_funnel.loan_amt,
                    zhl_purchase_funnel.down_payment_amt,
                    zhl_purchase_funnel.down_payment_pct,
                    zhl_purchase_funnel.is_jumbo_loan_ind,
                    zhl_purchase_funnel.has_agent_ind,
                    zhl_purchase_funnel.us_citizen_ind,
                    zhl_purchase_funnel.citizenship_type_txt,
                    zhl_purchase_funnel.foreclosure_ind,
                    zhl_purchase_funnel.bankruptcy_ind,
                    zhl_purchase_funnel.first_time_buyer_ind,
                    zhl_purchase_funnel.va_ind,
                    zhl_purchase_funnel.self_reported_credit_score_txt,
                    zhl_purchase_funnel.offramp_type_txt,
                    zhl_purchase_funnel.offramp_reason_txt,
                    zhl_purchase_funnel.zgmi_contact_id,
                    zhl_purchase_funnel.zhl_lead_id,
                    zhl_purchase_funnel.zgmi_missed_opportunity_id,
                    zhl_purchase_funnel.authenticated_ind,
                    zhl_purchase_funnel.employed_ind,
                    zhl_purchase_funnel.self_employed_ind,
                    zhl_purchase_funnel.social_security_ind,
                    zhl_purchase_funnel.pension_ind,
                    zhl_purchase_funnel.other_income_ind,
                    zhl_purchase_funnel.annual_employment_income_amt,
                    zhl_purchase_funnel.annual_self_employement_income_amt,
                    zhl_purchase_funnel.annual_social_security_income_amt,
                    zhl_purchase_funnel.annual_pension_income_amt,
                    zhl_purchase_funnel.annual_other_income_amt,
                    zhl_purchase_funnel.cash_ind,
                    zhl_purchase_funnel.brokerage_ind,
                    zhl_purchase_funnel.retirement_ind,
                    zhl_purchase_funnel.other_assets_ind,
                    zhl_purchase_funnel.cash_balance_amt,
                    zhl_purchase_funnel.brokerage_balance_amt,
                    zhl_purchase_funnel.retirement_balance_amt,
                    zhl_purchase_funnel.other_assets_balance_amt,
                    zhl_purchase_funnel.credit_consent_ind,
                    zhl_purchase_funnel.dti_nb,
                    zhl_purchase_funnel.soft_credit_score_nb,
                    zhl_purchase_funnel.loan_quote_mortgage_type_txt,
                    zhl_purchase_funnel.validation_error_message_viewed_txt,
                    zhl_purchase_funnel.property_value_amt,
                    zhl_purchase_funnel.validation_error_messages_viewed,
                    zhl_purchase_funnel.zhl_loan_id,
                    zhl_purchase_funnel.dti_dupos_nb,
                    zhl_purchase_funnel.retirement_income_ind,
                    zhl_purchase_funnel.retirement_income_amt,
                    zhl_purchase_funnel.home_owner_ind,
                    zhl_purchase_funnel.selling_ind,
                    zhl_purchase_funnel.renting_ind,
                    zhl_purchase_funnel.gift_ind,
                    zhl_purchase_funnel.gift_amt,
                    zhl_purchase_funnel.agent_referred_ind,
                    zhl_purchase_funnel.homeready_homepossible_ind,
                    zhl_purchase_funnel.monthly_payment_budget_amt,
                    zhl_purchase_funnel.cash_to_close_budget_amt,
                    zhl_purchase_funnel.property_value_nb,
                    zhl_purchase_funnel.down_payment_nb,
                    zhl_purchase_funnel.annual_employment_income_nb,
                    zhl_purchase_funnel.annual_self_employement_income_nb,
                    zhl_purchase_funnel.annual_social_security_income_nb,
                    zhl_purchase_funnel.annual_pension_income_nb,
                    zhl_purchase_funnel.annual_other_income_nb,
                    zhl_purchase_funnel.gift_nb,
                    zhl_purchase_funnel.cash_balance_nb,
                    zhl_purchase_funnel.brokerage_balance_nb,
                    zhl_purchase_funnel.retirement_balance_nb,
                    zhl_purchase_funnel.other_assets_balance_nb,
                    zhl_purchase_funnel.retirement_income_nb,
                    zhl_purchase_funnel.monthly_payment_budget_nb,
                    zhl_purchase_funnel.cash_to_close_budget_nb
                ) as struct<
                    loan_type_txt string,
                    journey_stage_txt string,
                    timeline_txt string,
                    city_or_zip_txt string,
                    zip_code_txt string,
                    state_txt string,
                    city_txt string,
                    county_txt string,
                    county_fips_txt string,
                    property_usage_txt string,
                    property_type_txt string,
                    loan_amt double,
                    down_payment_amt double,
                    down_payment_pct double,
                    is_jumbo_loan_ind boolean,
                    has_agent_ind boolean,
                    us_citizen_ind boolean,
                    citizenship_type_txt string,
                    foreclosure_ind boolean,
                    bankruptcy_ind boolean,
                    first_time_buyer_ind boolean,
                    va_ind boolean,
                    self_reported_credit_score_txt string,
                    offramp_type_txt string,
                    offramp_reason_txt string,
                    zgmi_contact_id string,
                    zhl_lead_id string,
                    zgmi_missed_opportunity_id string,
                    authenticated_ind boolean,
                    employed_ind boolean,
                    self_employed_ind boolean,
                    social_security_ind boolean,
                    pension_ind boolean,
                    other_income_ind boolean,
                    annual_employment_income_amt double,
                    annual_self_employement_income_amt double,
                    annual_social_security_income_amt double,
                    annual_pension_income_amt double,
                    annual_other_income_amt double,
                    cash_ind boolean,
                    brokerage_ind boolean,
                    retirement_ind boolean,
                    other_assets_ind boolean,
                    cash_balance_amt double,
                    brokerage_balance_amt double,
                    retirement_balance_amt double,
                    other_assets_balance_amt double,
                    credit_consent_ind boolean,
                    dti_nb double,
                    soft_credit_score_nb double,
                    loan_quote_mortgage_type_txt string,
                    validation_error_message_viewed_txt string,
                    property_value_amt double,
                    validation_error_messages_viewed array<string>,
                    zhl_loan_id string,
                    dti_dupos_nb double,
                    retirement_income_ind boolean,
                    retirement_income_amt double,
                    home_owner_ind boolean,
                    selling_ind boolean,
                    renting_ind boolean,
                    gift_ind boolean,
                    gift_amt double,
                    agent_referred_ind boolean,
                    homeready_homepossible_ind boolean,
                    monthly_payment_budget_amt double,
                    cash_to_close_budget_amt double,
                    property_value_nb integer,
                    down_payment_nb integer,
                    annual_employment_income_nb integer,
                    annual_self_employement_income_nb integer,
                    annual_social_security_income_nb integer,
                    annual_pension_income_nb integer,
                    annual_other_income_nb integer,
                    gift_nb integer,
                    cash_balance_nb integer,
                    brokerage_balance_nb integer,
                    retirement_balance_nb integer,
                    other_assets_balance_nb integer,
                    retirement_income_nb integer,
                    monthly_payment_budget_nb integer,
                    cash_to_close_budget_nb integer
                >
            ) as zhl_purchase_funnel,
            cast(
                struct(
                    zhl_purchase_funnel_results.loan_quote_mortgage_type_txt,
                    zhl_purchase_funnel_results.max_home_price_amt,
                    zhl_purchase_funnel_results.monthly_payment_amt,
                    zhl_purchase_funnel_results.monthly_principal_interest_amt,
                    zhl_purchase_funnel_results.monthly_hoa_amt,
                    zhl_purchase_funnel_results.monthly_hoi_amt,
                    zhl_purchase_funnel_results.pmi_amt,
                    zhl_purchase_funnel_results.monthly_taxes_amt,
                    zhl_purchase_funnel_results.cash_to_close_amt,
                    zhl_purchase_funnel_results.down_payment_amt,
                    zhl_purchase_funnel_results.down_payment_pct,
                    zhl_purchase_funnel_results.closing_costs_amt,
                    zhl_purchase_funnel_results.loan_amt,
                    zhl_purchase_funnel_results.max_home_price_nb,
                    zhl_purchase_funnel_results.monthly_payment_nb,
                    zhl_purchase_funnel_results.monthly_principal_interest_nb,
                    zhl_purchase_funnel_results.monthly_hoa_nb,
                    zhl_purchase_funnel_results.monthly_hoi_nb,
                    zhl_purchase_funnel_results.pmi_nb,
                    zhl_purchase_funnel_results.monthly_taxes_nb,
                    zhl_purchase_funnel_results.cash_to_close_nb,
                    zhl_purchase_funnel_results.down_payment_nb,
                    zhl_purchase_funnel_results.closing_costs_nb,
                    zhl_purchase_funnel_results.loan_nb
                ) as struct<
                    loan_quote_mortgage_type_txt string,
                    max_home_price_amt double,
                    monthly_payment_amt double,
                    monthly_principal_interest_amt double,
                    monthly_hoa_amt double,
                    monthly_hoi_amt double,
                    pmi_amt double,
                    monthly_taxes_amt double,
                    cash_to_close_amt double,
                    down_payment_amt double,
                    down_payment_pct double,
                    closing_costs_amt double,
                    loan_amt double,
                    max_home_price_nb integer,
                    monthly_payment_nb integer,
                    monthly_principal_interest_nb integer,
                    monthly_hoa_nb integer,
                    monthly_hoi_nb integer,
                    pmi_nb integer,
                    monthly_taxes_nb integer,
                    cash_to_close_nb integer,
                    down_payment_nb integer,
                    closing_costs_nb integer,
                    loan_nb integer
                >
            ) as zhl_purchase_funnel_results,
            cast(
                struct(
                    zhl_refi_funnel.loan_type_txt,
                    zhl_refi_funnel.state_txt,
                    zhl_refi_funnel.property_type_txt,
                    zhl_refi_funnel.property_use_txt,
                    zhl_refi_funnel.property_value_amt,
                    zhl_refi_funnel.self_reported_credit_score_txt,
                    zhl_refi_funnel.va_eligible_ind,
                    zhl_refi_funnel.annual_income_amt,
                    zhl_refi_funnel.self_employed_ind,
                    zhl_refi_funnel.foreclosure_bankruptcy_ind,
                    zhl_refi_funnel.second_mortgage_ind,
                    zhl_refi_funnel.cash_out_ind,
                    zhl_refi_funnel.loan_balance_amt,
                    zhl_refi_funnel.zhl_lead_id
                ) as struct<
                    loan_type_txt string,
                    state_txt string,
                    property_type_txt string,
                    property_use_txt string,
                    property_value_amt double,
                    self_reported_credit_score_txt string,
                    va_eligible_ind boolean,
                    annual_income_amt double,
                    self_employed_ind boolean,
                    foreclosure_bankruptcy_ind boolean,
                    second_mortgage_ind boolean,
                    cash_out_ind boolean,
                    loan_balance_amt double,
                    zhl_lead_id string
                >
            ) as zhl_refi_funnel,
            cast(
                struct(zhl_resources_info.resource_page_title_txt) as struct<
                    resource_page_title_txt string
                >
            ) as zhl_resources_info,
            cast(
                struct(
                    financing_calculator.calculator_txt,
                    financing_calculator.estimated_monthly_payment_amt,
                    financing_calculator.property_value_amt,
                    financing_calculator.down_payment_amt,
                    financing_calculator.down_payment_pct,
                    financing_calculator.loan_program_txt,
                    financing_calculator.interest_rt,
                    financing_calculator.pmi_ind,
                    financing_calculator.taxes_insurance_ind,
                    financing_calculator.property_tax_amt,
                    financing_calculator.property_tax_pct,
                    financing_calculator.home_insurance_amt,
                    financing_calculator.hoa_dues_amt,
                    financing_calculator.refinance_savings_amt,
                    financing_calculator.current_loan_amt,
                    financing_calculator.current_term_nb,
                    financing_calculator.origination_year_txt,
                    financing_calculator.new_loan_amt,
                    financing_calculator.new_interest_rt,
                    financing_calculator.new_term_nb,
                    financing_calculator.refinance_fees_amt,
                    financing_calculator.cash_out_amt,
                    financing_calculator.roll_fees_ind,
                    financing_calculator.home_affordability_amt,
                    financing_calculator.maximum_payment_amt,
                    financing_calculator.annual_income_amt,
                    financing_calculator.monthly_debts_amt,
                    financing_calculator.dti_self_reported_pct,
                    financing_calculator.loan_start_date_month_txt,
                    financing_calculator.loan_start_date_year_txt,
                    financing_calculator.dti_calculated_pct,
                    financing_calculator.total_monthly_debts_amt,
                    financing_calculator.mortgage_payment_amt,
                    financing_calculator.remaining_monthly_income_amt,
                    financing_calculator.min_credit_card_payments_amt,
                    financing_calculator.car_loan_payments_amt,
                    financing_calculator.student_loan_payments_amt,
                    financing_calculator.alimony_child_support_payments_amt,
                    financing_calculator.secondary_home_expenses_amt,
                    financing_calculator.other_loan_or_debt_payments_amt,
                    financing_calculator.include_utilities_ind,
                    financing_calculator.water_sewer_amt,
                    financing_calculator.gas_amt,
                    financing_calculator.internet_amt,
                    financing_calculator.electric_amt,
                    financing_calculator.zip_code_txt
                ) as struct<
                    calculator_txt string,
                    estimated_monthly_payment_amt double,
                    property_value_amt double,
                    down_payment_amt double,
                    down_payment_pct double,
                    loan_program_txt string,
                    interest_rt double,
                    pmi_ind boolean,
                    taxes_insurance_ind boolean,
                    property_tax_amt double,
                    property_tax_pct double,
                    home_insurance_amt double,
                    hoa_dues_amt double,
                    refinance_savings_amt double,
                    current_loan_amt double,
                    current_term_nb integer,
                    origination_year_txt string,
                    new_loan_amt double,
                    new_interest_rt double,
                    new_term_nb integer,
                    refinance_fees_amt double,
                    cash_out_amt double,
                    roll_fees_ind boolean,
                    home_affordability_amt double,
                    maximum_payment_amt double,
                    annual_income_amt double,
                    monthly_debts_amt double,
                    dti_self_reported_pct double,
                    loan_start_date_month_txt string,
                    loan_start_date_year_txt string,
                    dti_calculated_pct double,
                    total_monthly_debts_amt double,
                    mortgage_payment_amt double,
                    remaining_monthly_income_amt double,
                    min_credit_card_payments_amt double,
                    car_loan_payments_amt double,
                    student_loan_payments_amt double,
                    alimony_child_support_payments_amt double,
                    secondary_home_expenses_amt double,
                    other_loan_or_debt_payments_amt double,
                    include_utilities_ind boolean,
                    water_sewer_amt double,
                    gas_amt double,
                    internet_amt double,
                    electric_amt double,
                    zip_code_txt string
                >
            ) as financing_calculator,
            cast(
                struct(
                    hdp_mortgage_row_details.est_payment_amt,
                    hdp_mortgage_row_details.est_payment_is_personalized,
                    hdp_mortgage_row_details.stored_down_payment_dollar_amt,
                    hdp_mortgage_row_details.stored_down_payment_percent_amt,
                    hdp_mortgage_row_details.stored_credit_score_high_amt,
                    hdp_mortgage_row_details.stored_credit_score_low_amt,
                    hdp_mortgage_row_details.rate_source_txt,
                    hdp_mortgage_row_details.disclaimer_txt,
                    hdp_mortgage_row_details.experiment_trial_txt,
                    hdp_mortgage_row_details.experiment_treatment_txt,
                    hdp_mortgage_row_details.error_reason_txt
                ) as struct<
                    est_payment_amt double,
                    est_payment_is_personalized boolean,
                    stored_down_payment_dollar_amt double,
                    stored_down_payment_percent_amt double,
                    stored_credit_score_high_amt double,
                    stored_credit_score_low_amt double,
                    rate_source_txt string,
                    disclaimer_txt string,
                    experiment_trial_txt string,
                    experiment_treatment_txt string,
                    error_reason_txt string
                >
            ) as hdp_mortgage_row_details,
            cast(
                struct(
                    personalized_payment_modal_details.est_payment_amt,
                    personalized_payment_modal_details.est_payment_is_personalized,
                    personalized_payment_modal_details.stored_down_payment_dollar_amt,
                    personalized_payment_modal_details.stored_down_payment_percent_amt,
                    personalized_payment_modal_details.stored_credit_score_high_amt,
                    personalized_payment_modal_details.stored_credit_score_low_amt,
                    personalized_payment_modal_details.rate_source_txt,
                    personalized_payment_modal_details.disclaimer_txt,
                    personalized_payment_modal_details.experiment_trial_txt,
                    personalized_payment_modal_details.experiment_treatment_txt,
                    personalized_payment_modal_details.input_down_payment_preference_txt,
                    personalized_payment_modal_details.input_down_payment_dollar_amt,
                    personalized_payment_modal_details.input_down_payment_percent_amt,
                    personalized_payment_modal_details.input_credit_score_high_amt,
                    personalized_payment_modal_details.input_credit_score_low_amt,
                    personalized_payment_modal_details.tooltip_location_txt,
                    personalized_payment_modal_details.error_reason_txt
                ) as struct<
                    est_payment_amt double,
                    est_payment_is_personalized boolean,
                    stored_down_payment_dollar_amt double,
                    stored_down_payment_percent_amt double,
                    stored_credit_score_high_amt double,
                    stored_credit_score_low_amt double,
                    rate_source_txt string,
                    disclaimer_txt string,
                    experiment_trial_txt string,
                    experiment_treatment_txt string,
                    input_down_payment_preference_txt string,
                    input_down_payment_dollar_amt double,
                    input_down_payment_percent_amt double,
                    input_credit_score_high_amt double,
                    input_credit_score_low_amt double,
                    tooltip_location_txt string,
                    error_reason_txt string
                >
            ) as personalized_payment_modal_details,
            cast(
                struct(
                    zhl_verify_summary_counts.employer_income_cnt,
                    zhl_verify_summary_counts.checking_account_cnt,
                    zhl_verify_summary_counts.savings_account_cnt,
                    zhl_verify_summary_counts.money_market_account_cnt,
                    zhl_verify_summary_counts.cd_account_cnt,
                    zhl_verify_summary_counts.stock_account_cnt,
                    zhl_verify_summary_counts.stock_options_account_cnt,
                    zhl_verify_summary_counts.bonds_account_cnt,
                    zhl_verify_summary_counts.mutual_funds_cnt,
                    zhl_verify_summary_counts.retirement_account_cnt,
                    zhl_verify_summary_counts.w2_tasks_cnt,
                    zhl_verify_summary_counts.paystub_tasks_cnt,
                    zhl_verify_summary_counts.bank_statement_tasks_cnt
                ) as struct<
                    employer_income_cnt integer,
                    checking_account_cnt integer,
                    savings_account_cnt integer,
                    money_market_account_cnt integer,
                    cd_account_cnt integer,
                    stock_account_cnt integer,
                    stock_options_account_cnt integer,
                    bonds_account_cnt integer,
                    mutual_funds_cnt integer,
                    retirement_account_cnt integer,
                    w2_tasks_cnt integer,
                    paystub_tasks_cnt integer,
                    bank_statement_tasks_cnt integer
                >
            ) as zhl_verify_summary_counts,
            cast(
                struct(
                    zhl_purchase_verify.zhl_lead_id,
                    zhl_purchase_verify.zhl_loan_id,
                    zhl_purchase_verify.zhl_preapproval_status_txt
                ) as struct<
                    zhl_lead_id string,
                    zhl_loan_id string,
                    zhl_preapproval_status_txt string
                >
            ) as zhl_purchase_verify,
            cast(
                struct(
                    buying_power.config_ind,
                    buying_power.module_state_txt,
                    buying_power.button_txt,
                    buying_power.button_destination_txt,
                    buying_power.button_helper_txt,
                    buying_power.is_error_ind,
                    buying_power.field_with_error_txt,
                    buying_power.error_txt,
                    buying_power.location_input_type_txt,
                    buying_power.input_entered_ind,
                    buying_power.input_field_nm,
                    buying_power.input_field_txt,
                    buying_power.tooltip_nm_txt,
                    buying_power.error_nm_txt,
                    buying_power.button_nm_txt,
                    buying_power.is_zhl_rate_ind
                ) as struct<
                    config_ind boolean,
                    module_state_txt string,
                    button_txt string,
                    button_destination_txt string,
                    button_helper_txt string,
                    is_error_ind boolean,
                    field_with_error_txt string,
                    error_txt string,
                    location_input_type_txt string,
                    input_entered_ind boolean,
                    input_field_nm string,
                    input_field_txt string,
                    tooltip_nm_txt string,
                    error_nm_txt string,
                    button_nm_txt string,
                    is_zhl_rate_ind boolean
                >
            ) as buying_power,
            cast(
                struct(
                    device_info.device_category_nm,
                    device_info.device_type_nm,
                    device_info.screen_resolution_txt,
                    device_info.device_nm,
                    device_info.device_manufacturer_nm,
                    device_info.device_model_nm,
                    device_info.os_nm,
                    device_info.os_version_id,
                    device_info.browser_nm,
                    device_info.language_cd,
                    device_info.country_nm,
                    device_info.state_cd,
                    device_info.city_nm,
                    device_info.zip_cd,
                    device_info.longitude_nb,
                    device_info.latitude_nb,
                    device_info.device_timezone_cd,
                    device_info.dma_txt,
                    device_info.dma_nm,
                    device_info.msa_nm,
                    device_info.region_nm,
                    device_info.browser_type_nm
                ) as struct<
                    device_category_nm string,
                    device_type_nm string,
                    screen_resolution_txt string,
                    device_nm string,
                    device_manufacturer_nm string,
                    device_model_nm string,
                    os_nm string,
                    os_version_id string,
                    browser_nm string,
                    language_cd string,
                    country_nm string,
                    state_cd string,
                    city_nm string,
                    zip_cd string,
                    longitude_nb double,
                    latitude_nb double,
                    device_timezone_cd string,
                    dma_txt string,
                    dma_nm string,
                    msa_nm string,
                    region_nm string,
                    browser_type_nm string
                >
            ) as device_info,
            cast(
                struct(
                    property_info.zpid,
                    property_info.lot_id,
                    property_info.saved_ind,
                    property_info.imx_ind,
                    property_info.imx_2_ind,
                    property_info.tour_3d_ind,
                    property_info.similar_homes_zpids,
                    property_info.homes_for_you_zpids,
                    property_info.lot_ids,
                    property_info.other_available_plans_zpids,
                    property_info.similar_rentals_zpids,
                    property_info.nearby_homes_zpids,
                    property_info.nearby_rentals_zpids,
                    property_info.homes_in_community,
                    property_info.matterport_ind,
                    property_info.zillow_owned_exp_ind,
                    property_info.showcase_hdp_ind,
                    property_info.third_party_vt_ind,
                    property_info.video_ind,
                    property_info.target_property_zpid,
                    property_info.target_community_plid,
                    property_info.provider_listing_id,
                    property_info.raw_home_status_cd,
                    property_info.display_status_cd,
                    property_info.marketing_status_simplified_cd,
                    property_info.is_paid_ind,
                    property_info.state_cd,
                    property_info.county_nm,
                    property_info.city_nm,
                    property_info.zip_cd,
                    property_info.street_address_txt,
                    property_info.price_amt,
                    property_info.listing_status_cd,
                    property_info.listing_type_cd,
                    property_info.latitude_nb,
                    property_info.longitude_nb,
                    property_info.city_id,
                    property_info.state_id,
                    property_info.bath_cnt,
                    property_info.bedroom_cnt,
                    property_info.sqft_nb,
                    property_info.year_built_nb,
                    property_info.lot_size_acre_nb,
                    property_info.home_type_cd,
                    property_info.story_cnt_nb,
                    property_info.mpid,
                    property_info.school_district_nm,
                    property_info.listing_ts,
                    property_info.photo_cnt,
                    property_info.property_dsc,
                    property_info.enrichment_ts,
                    property_info.enrichment_source_nm,
                    property_info.currency_type_cd,
                    property_info.county_id,
                    property_info.neighborhood_id,
                    property_info.country_cd,
                    property_info.displayed_highlights,
                    property_info.fixture_classification_cd,
                    property_info.hdp_showcase_ind,
                    property_info.is_owner_occupied_ind,
                    property_info.nearby_rental_homes_impression_zpids,
                    property_info.provider_category_cd,
                    property_info.foreclosure_stage_cd,
                    property_info.broker_id,
                    property_info.room_for_rent_ind,
                    property_info.tracing_id,
                    property_info.pdc_home_type_txt,
                    property_info.tour_url_txt,
                    property_info.property_tracing_id,
                    property_info.zipcode_id
                ) as struct<
                    zpid integer,
                    lot_id string,
                    saved_ind boolean,
                    imx_ind boolean,
                    imx_2_ind boolean,
                    tour_3d_ind boolean,
                    similar_homes_zpids array<integer>,
                    homes_for_you_zpids array<integer>,
                    lot_ids array<integer>,
                    other_available_plans_zpids array<integer>,
                    similar_rentals_zpids array<integer>,
                    nearby_homes_zpids array<integer>,
                    nearby_rentals_zpids array<integer>,
                    homes_in_community array<integer>,
                    matterport_ind boolean,
                    zillow_owned_exp_ind boolean,
                    showcase_hdp_ind boolean,
                    third_party_vt_ind boolean,
                    video_ind boolean,
                    target_property_zpid integer,
                    target_community_plid string,
                    provider_listing_id string,
                    raw_home_status_cd string,
                    display_status_cd string,
                    marketing_status_simplified_cd string,
                    is_paid_ind boolean,
                    state_cd string,
                    county_nm string,
                    city_nm string,
                    zip_cd string,
                    street_address_txt string,
                    price_amt integer,
                    listing_status_cd string,
                    listing_type_cd string,
                    latitude_nb double,
                    longitude_nb double,
                    city_id integer,
                    state_id integer,
                    bath_cnt real,
                    bedroom_cnt integer,
                    sqft_nb double,
                    year_built_nb string,
                    lot_size_acre_nb double,
                    home_type_cd string,
                    story_cnt_nb real,
                    mpid bigint,
                    school_district_nm string,
                    listing_ts string,
                    photo_cnt integer,
                    property_dsc string,
                    enrichment_ts string,
                    enrichment_source_nm string,
                    currency_type_cd string,
                    county_id integer,
                    neighborhood_id integer,
                    country_cd string,
                    displayed_highlights array<string>,
                    fixture_classification_cd string,
                    hdp_showcase_ind boolean,
                    is_owner_occupied_ind boolean,
                    nearby_rental_homes_impression_zpids array<integer>,
                    provider_category_cd string,
                    foreclosure_stage_cd string,
                    broker_id string,
                    room_for_rent_ind boolean,
                    tracing_id integer,
                    pdc_home_type_txt string,
                    tour_url_txt string,
                    property_tracing_id string,
                    zipcode_id integer
                >
            ) as property_info,
            brand_cd,
            platform_nm,
            from_utc_timestamp(current_timestamp(), 'PST') as update_timestamp_pst,
            current_date record_update_dt,
            cast(
                struct(
                    cms_info.taxonomy_target_personas_txt,
                    cms_info.taxonomy_target_brands_txt,
                    cms_info.taxonomy_categories_txt,
                    cms_info.taxonomy_tags_txt,
                    cms_info.agent_type_txt,
                    cms_info.block_id,
                    cms_info.block_type_cd,
                    cms_info.block_displayed_txt,
                    cms_info.block_target_url,
                    cms_info.block_target_window_txt,
                    cms_info.block_slide_nb,
                    cms_info.block_media_host_txt,
                    cms_info.block_media_url,
                    cms_info.apex_business_line_txt,
                    cms_info.apex_warm_lead_source_txt,
                    cms_info.apex_form_is_valid_ind,
                    cms_info.apex_invalid_fields_txt,
                    cms_info.apex_submit_success_ind,
                    cms_info.apex_server_response_message_txt,
                    cms_info.apex_sms_txt,
                    cms_info.apex_submit_label_txt,
                    cms_info.apex_mobile_submit_label_txt,
                    cms_info.apex_mobile_url,
                    cms_info.content_location_scroll_depth_percentage_nb,
                    cms_info.content_location_scroll_depth_pixels_nb,
                    cms_info.content_location_scroll_depth_page_height_nb,
                    cms_info.form_business_line_txt,
                    cms_info.form_warm_lead_source_txt,
                    cms_info.form_is_valid_ind,
                    cms_info.form_invalid_fields_txt,
                    cms_info.form_submit_success_ind,
                    cms_info.form_server_response_message_txt,
                    cms_info.form_sms_txt,
                    cms_info.form_submit_label_txt,
                    cms_info.form_mobile_submit_label_txt,
                    cms_info.form_mobile_url
                ) as struct<
                    taxonomy_target_personas_txt array<string>,
                    taxonomy_target_brands_txt array<string>,
                    taxonomy_categories_txt array<string>,
                    taxonomy_tags_txt array<string>,
                    agent_type_txt string,
                    block_id string,
                    block_type_cd string,
                    block_displayed_txt string,
                    block_target_url string,
                    block_target_window_txt string,
                    block_slide_nb double,
                    block_media_host_txt string,
                    block_media_url string,
                    apex_business_line_txt string,
                    apex_warm_lead_source_txt string,
                    apex_form_is_valid_ind boolean,
                    apex_invalid_fields_txt array<string>,
                    apex_submit_success_ind boolean,
                    apex_server_response_message_txt string,
                    apex_sms_txt string,
                    apex_submit_label_txt string,
                    apex_mobile_submit_label_txt string,
                    apex_mobile_url string,
                    content_location_scroll_depth_percentage_nb double,
                    content_location_scroll_depth_pixels_nb double,
                    content_location_scroll_depth_page_height_nb double,
                    form_business_line_txt string,
                    form_warm_lead_source_txt string,
                    form_is_valid_ind boolean,
                    form_invalid_fields_txt array<string>,
                    form_submit_success_ind boolean,
                    form_server_response_message_txt string,
                    form_sms_txt string,
                    form_submit_label_tx string,
                    form_mobile_submit_label_txt string,
                    form_mobile_url string
                >
            ) as cms_info,
            cast(
                struct(
                    illuminate_home_loans.has_loan_ind,
                    illuminate_home_loans.selected_resource_txt
                ) as struct<has_loan_ind boolean, selected_resource_txt string>
            ) as illuminate_home_loans
        from {{ source("clickstream", "daily_web_nopii") }}
        where
            cast(client_data_pst_dt as date)
            = date_add(cast("{{ var('process_date') }}" as date), -1)
            and brand_cd = 'zillow'
            /* exclude largest event id with exceptions */
            and envelope.event_type_id
            not in (select event_type_id from clickstream_event_registry_exclusions)
    )

select *
from daily_mobile_nopii
union all
select *
from daily_web_nopii
